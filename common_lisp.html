<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>common lisp</title><!-- for google analytics -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QNNF19VZGH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QNNF19VZGH');
</script>

<!-- lambda icon, frail attempt -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%221em%22 font-size=%22100%22 color=%22red%22>Î»</text></svg>">
<!-- not-so-awesome awesome font -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="/main.css">
<!-- for dark mode -->
<script src="darkmode.js"></script>
<script src="main.js"></script>
<script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
<div id="preamble" class="status">
<div class="navbar">
  <a href='/'>home</a>
  <a href='/blog.html'>blog</a>
  <a href='/search.html'>search</a>
  <a href='/about.html'>about</a>
  <div id="darkModeToggle" onclick="toggleDarkMode()">
    &#9680; <!-- Circle with left half black -->
  </div>
</div>
<div class="toc">
  <span class="toc-title-container">
    <a class='feather' data-feather='menu'></a>
    <span class="toc-title">table of contents</span>
  </span>
  <div class="toc-list">
  </div>
</div><h1 class="main-title">common lisp</h1><span class='date'>2023-02-24</span>
</div>
<div id="content" class="content">
<div id="outline-container-org31422a8" class="outline-2">
<h2 id="org31422a8">for loop</h2>
<div class="outline-text-2" id="text-org31422a8">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">loop</span> for x in '<span style="color: #b16286;">(</span>1 2 3<span style="color: #b16286;">)</span>
      collect x<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">returns list</span>
<span style="color: #458588;">(</span><span style="color: #fb4933;">loop</span> for x in '<span style="color: #b16286;">(</span>1 2 3<span style="color: #b16286;">)</span>
      do <span style="color: #b16286;">(</span>print x<span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">prints the numbers</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgad53ea2" class="outline-2">
<h2 id="orgad53ea2">functions</h2>
<div class="outline-text-2" id="text-orgad53ea2">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defun</span> <span style="color: #fabd2f;">&lt;name&gt;</span> <span style="color: #b16286;">(</span>list of arguments<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"docstring"</span>
  <span style="color: #b16286;">(</span>body<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3e38b25" class="outline-2">
<h2 id="org3e38b25">plist</h2>
<div class="outline-text-2" id="text-org3e38b25">
<p>
defining a plist
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>setf my-plist '<span style="color: #b16286;">(</span>alt <span style="color: #b8bb26;">"yes"</span> bar <span style="color: #b8bb26;">"no"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
retrieve a value by key
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>getf my-plist 'alt<span style="color: #458588;">)</span>
</pre>
</div>

<p>
change the value that corresponds to a key
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>setf <span style="color: #b16286;">(</span>getf my-plist 'alt<span style="color: #b16286;">)</span> 45<span style="color: #458588;">)</span>
</pre>
</div>

<p>
get a list of the attributes
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">loop</span> for <span style="color: #b16286;">(</span>key value<span style="color: #b16286;">)</span> on my-plist by #'cddr
      collect key<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4f60877" class="outline-2">
<h2 id="org4f60877">unbind variable</h2>
<div class="outline-text-2" id="text-org4f60877">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>makunbound 'foo<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcf9e189" class="outline-2">
<h2 id="orgcf9e189">undefine funciton</h2>
<div class="outline-text-2" id="text-orgcf9e189">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>fmakunbound 'function<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcb1f53b" class="outline-2">
<h2 id="orgcb1f53b">quicklisp</h2>
<div class="outline-text-2" id="text-orgcb1f53b">
<p>
need to install it manually afaik
</p>
<div class="org-src-container" data-language="bash">
<pre class="src src-bash">curl -O https://beta.quicklisp.org/quicklisp.lisp
sbcl --load quicklisp.lisp
</pre>
</div>

<p>
then in sbcl
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>quicklisp-quickstart:install <span style="color: #fe8019;">:path</span> <span style="color: #b8bb26;">"~/.quicklisp"</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>ql:add-to-init-file<span style="color: #458588;">)</span>
</pre>
</div>

<p>
then to install a package in sbcl:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>ql:quickload <span style="color: #b8bb26;">"cl-csv"</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
this will install the package if it doesnt exist, and if it exists it just loads it
</p>
</div>
</div>
<div id="outline-container-org920526e" class="outline-2">
<h2 id="org920526e">classes</h2>
<div class="outline-text-2" id="text-org920526e">
<p>
example class:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defclass</span> <span style="color: #d3869b;">my-class</span> <span style="color: #b16286;">()</span>
  <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>property1 <span style="color: #fe8019;">:accessor</span> property1-accessor<span style="color: #8ec07c;">)</span>
   <span style="color: #8ec07c;">(</span>property2 <span style="color: #fe8019;">:accessor</span> property2-accessor<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<p>
the <code>accessor</code> is the name you use to access a property1
we construct an object using <code>make-instance</code>:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defvar</span> <span style="color: #83a598;">p1</span> <span style="color: #b16286;">(</span>make-instance 'my-class<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<p>
we can initialize the class with specific values, first we need to use the <code>:initarg</code> keyword on the class properties
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defclass</span> <span style="color: #d3869b;">my-class</span> <span style="color: #b16286;">()</span>
  <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>property1 <span style="color: #fe8019;">:initarg</span> property1-initarg <span style="color: #fe8019;">:initform</span> default-value <span style="color: #fe8019;">:accessor</span> property1-accessor<span style="color: #8ec07c;">)</span>
   <span style="color: #8ec07c;">(</span>property2 <span style="color: #fe8019;">:accessor</span> property2-accessor<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<p>
then we can pass the values we want to <code>make-instance</code>
<code>:initform</code> is used to pass a default value to the slot incase <code>:initarg</code> argument isnt passed to <code>make-instance</code>
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defvar</span> <span style="color: #83a598;">p1</span> <span style="color: #b16286;">(</span>make-instance 'my-class <span style="color: #fe8019;">:property1-initarg</span> property1-value<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<p>
this is the syntax for accessing variables of a class
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>property1-accessor p1<span style="color: #458588;">)</span>
</pre>
</div>

<p>
we can do inheritance by passing the parent class in the parenthases after the class name:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defclass</span> <span style="color: #d3869b;">my-class</span> <span style="color: #b16286;">(</span>my-parent-class<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
the following syntax is used to define a function for a class, note that the function <code>print-object</code> is the function that gets called when trying to print an object using <code>(print object)</code> so thats what we're defining here
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defmethod</span> <span style="color: #fabd2f;">print-object</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>obj my-class<span style="color: #8ec07c;">)</span> stream<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>print-unreadable-object <span style="color: #8ec07c;">(</span>obj stream <span style="color: #fe8019;">:type</span> t<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>format stream <span style="color: #b8bb26;">"value of property1: ~a"</span> <span style="color: #d65d0e;">(</span>property1 obj<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org08652cc" class="outline-2">
<h2 id="org08652cc">structs</h2>
<div class="outline-text-2" id="text-org08652cc">
<p>
structs are basically simpler classes with default functions/initializers/etc
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defstruct</span> <span style="color: #d3869b;">rgb</span> <span style="color: #b16286;">()</span>
           <span style="color: #b16286;">(</span>r 0<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>g 0<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>b 0<span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">initialize slot values to 0</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">e.g. constructor built by default</span>
<span style="color: #458588;">(</span>setf color <span style="color: #b16286;">(</span>make-rgb <span style="color: #fe8019;">:r</span> 2<span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; #S(RGB :NIL NIL :R 2 :G 0 :B 0)</span>

<span style="color: #458588;">(</span>list <span style="color: #b16286;">(</span>rgb-r color<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>rgb-b color<span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; (2 0)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8467994" class="outline-2">
<h2 id="org8467994">arrays/matrices</h2>
<div class="outline-text-2" id="text-org8467994">
<p>
to create an array:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>make-array 10 <span style="color: #fe8019;">:initial-element</span> 10<span style="color: #458588;">)</span>
</pre>
</div>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
<td class="org-right">10</td>
</tr>
</tbody>
</table>

<p>
multidimensional arrays:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>make-array '<span style="color: #b16286;">(</span>4 3<span style="color: #b16286;">)</span> <span style="color: #fe8019;">:initial-element</span> 15<span style="color: #458588;">)</span>
</pre>
</div>


<pre class="example">
#2A((15 15 15) (15 15 15) (15 15 15) (15 15 15))
</pre>


<p>
access slot in array
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>aref <span style="color: #b16286;">(</span>make-array '<span style="color: #8ec07c;">(</span>4 3 1<span style="color: #8ec07c;">)</span> <span style="color: #fe8019;">:initial-element</span> 15<span style="color: #b16286;">)</span> 2 0 0<span style="color: #458588;">)</span>
</pre>
</div>


<pre class="example">
15
</pre>


<p>
get the length of the array (last argument is the dimension to check length of):
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>print <span style="color: #b16286;">(</span>array-dimension <span style="color: #8ec07c;">(</span>make-array '<span style="color: #d65d0e;">(</span>4 3<span style="color: #d65d0e;">)</span> <span style="color: #fe8019;">:initial-element</span> 15<span style="color: #8ec07c;">)</span> 0<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>print <span style="color: #b16286;">(</span>array-dimension <span style="color: #8ec07c;">(</span>make-array '<span style="color: #d65d0e;">(</span>4 3<span style="color: #d65d0e;">)</span> <span style="color: #fe8019;">:initial-element</span> 15<span style="color: #8ec07c;">)</span> 1<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<pre class="example">

4 
3 
</pre>


<p>
iterate through array:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>map nil #'print <span style="color: #b16286;">(</span>make-array 3 <span style="color: #fe8019;">:initial-element</span> 15<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<pre class="example">

15 
15 
15 
</pre>


<p>
iterate with index:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">let</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>arr <span style="color: #d65d0e;">(</span>make-array '<span style="color: #458588;">(</span>4 3<span style="color: #458588;">)</span> <span style="color: #fe8019;">:initial-element</span> 15<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4933;">loop</span> for i from 0 below <span style="color: #8ec07c;">(</span>array-dimension arr 0<span style="color: #8ec07c;">)</span>
    do <span style="color: #8ec07c;">(</span>print <span style="color: #d65d0e;">(</span>aref arr i 1<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<pre class="example">

15 
15 
15 
15 
</pre>


<p>
use displacement arrays to get the first element of every row in a 2d array:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">loop</span> for i from 0 below <span style="color: #b16286;">(</span>array-dimension arr 0<span style="color: #b16286;">)</span>
      collect <span style="color: #b16286;">(</span><span style="color: #fb4933;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>row <span style="color: #458588;">(</span>make-array
                          <span style="color: #b16286;">(</span>array-dimension arr 1<span style="color: #b16286;">)</span>
                          <span style="color: #fe8019;">:displaced-to</span> arr
                          <span style="color: #fe8019;">:displaced-index-offset</span> <span style="color: #b16286;">(</span>* i <span style="color: #8ec07c;">(</span>array-dimension arr 1<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                <span style="color: #8ec07c;">(</span>aref row 0<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<p>
we can create resizable arrays with the <code>:adjustable</code> keyword, <code>:fill-pointer</code> denotes the next position to be filled in the array and is automatically maintained by the array itself, but has to be initialized
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defparameter</span> <span style="color: #83a598;">*x*</span> <span style="color: #b16286;">(</span>make-array 0 <span style="color: #fe8019;">:adjustable</span> t <span style="color: #fe8019;">:fill-pointer</span> 0<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>vector-push-extend 'a *x*<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>vector-push-extend 'b *x*<span style="color: #458588;">)</span>
*x*
</pre>
</div>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">A</td>
<td class="org-left">B</td>
</tr>
</tbody>
</table>

<p>
fill array manually:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>make-array '<span style="color: #b16286;">(</span>3 3<span style="color: #b16286;">)</span> <span style="color: #fe8019;">:initial-contents</span> '<span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>1 0 0<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>0 1 0<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>0 0 1<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb433d5b" class="outline-2">
<h2 id="orgb433d5b">vectors</h2>
<div class="outline-text-2" id="text-orgb433d5b">
<p>
create vector
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>vector 3 5 1<span style="color: #458588;">)</span>
</pre>
</div>


<p>
we can use <code>length</code> on vectors
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>length <span style="color: #b16286;">(</span>vector 3 5 1<span style="color: #b16286;">)</span><span style="color: #458588;">)</span> ==&gt; 3
</pre>
</div>


<p>
get nth element:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defparameter</span> <span style="color: #83a598;">*x*</span> <span style="color: #b16286;">(</span>vector 1 2 3<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>length *x*<span style="color: #458588;">)</span> ==&gt; 3
<span style="color: #458588;">(</span>elt *x* 1<span style="color: #458588;">)</span>  ==&gt; 2
</pre>
</div>


<p>
we can have nested vectors
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">let</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>a <span style="color: #d65d0e;">(</span>vector <span style="color: #458588;">(</span>vector 1 2<span style="color: #458588;">)</span> <span style="color: #458588;">(</span>vector 3<span style="color: #458588;">)</span> 4<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>print a<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>print <span style="color: #8ec07c;">(</span>elt a 0<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<pre class="example">

#(#(1 2) #(3) 4) 
#(1 2) 
</pre>
</div>
</div>
<div id="outline-container-org5b64c7b" class="outline-2">
<h2 id="org5b64c7b">multithreading</h2>
<div class="outline-text-2" id="text-org5b64c7b">
<p>
in <a href="/sbcl.html">sbcl</a> <code>sb-thread:make-thread</code> takes a function to call in a newly created thread.
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>sb-thread:make-thread
 <span style="color: #b16286;">(</span><span style="color: #fb4933;">lambda</span> <span style="color: #8ec07c;">()</span>
   <span style="color: #8ec07c;">(</span><span style="color: #fb4933;">progn</span>
     <span style="color: #d65d0e;">(</span>sleep 0<span style="color: #d65d0e;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">give other threads a chance to run, then return here</span>
     <span style="color: #d65d0e;">(</span>setf c <span style="color: #458588;">(</span>+ a b<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
     <span style="color: #d65d0e;">(</span>print <span style="color: #b8bb26;">"ADDITION:"</span><span style="color: #d65d0e;">)</span>
     <span style="color: #d65d0e;">(</span>print c<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
although notice that this is special to sbcl.
</p>

<p>
the <a href="https://github.com/lmj/lparallel">lparallel</a> library works great on multiple CL implementations, more on lparallel at <a href="https://lparallel.org/page/2/">https://lparallel.org/page/2/</a>
</p>
</div>
</div>
<div id="outline-container-org8bbae38" class="outline-2">
<h2 id="org8bbae38">macros</h2>
<div class="outline-text-2" id="text-org8bbae38">
<p>
simple macro from <a href="https://lispcookbook.github.io/cl-cookbook/macros.html">https://lispcookbook.github.io/cl-cookbook/macros.html</a>:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defmacro</span> <span style="color: #fabd2f;">setq2</span> <span style="color: #b16286;">(</span>v1 v2 e<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>list 'progn <span style="color: #8ec07c;">(</span>list 'setq v1 e<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>list 'setq v2 e<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(setq2 v1 v2 3) =&gt; v1=3,v2=3</span>
</pre>
</div>

<p>
this macro is very close to the following function definition:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defun</span> <span style="color: #fabd2f;">setq2-function</span> <span style="color: #b16286;">(</span>v1 v2 e<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>list 'progn <span style="color: #8ec07c;">(</span>list 'setq v1 e<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>list 'setq v2 e<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
consider the following macro <code>when2</code> which behaves like the builtin <code>when</code>
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defmacro</span> <span style="color: #fabd2f;">when2</span> <span style="color: #b16286;">(</span>condition <span style="color: #d3869b;">&amp;rest</span> body<span style="color: #b16286;">)</span>
  `<span style="color: #b16286;">(</span><span style="color: #fb4933;">if</span> ,condition <span style="color: #8ec07c;">(</span><span style="color: #fb4933;">progn</span> ,@body<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(when2 t (print "hey")) =&gt; "hey"</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(when2 nil (print "hey")) =&gt; nothing</span>
</pre>
</div>

<div test="test" class="fancy-block note" data-before="&lt;p&gt;
note: &lt;/p&gt;
" id="def-graph-del" data-id="def-graph-del">
<p>
from <a href="http://www.lispworks.com/documentation/HyperSpec/Body/02_df.htm">http://www.lispworks.com/documentation/HyperSpec/Body/02_df.htm</a>
if a comma is immediately followed by an at-sign, then the form following the at-sign is evaluated to produce a list of objects. these objects are then âsplicedâ into place in the template. for example, if x has the value (a b c), then
 `(x ,x ,@x foo ,(cadr x) bar ,(cdr x) baz ,@(cdr x))
=&gt;  (x (a b c) a b c foo b bar (b c) baz b c)
</p>

</div>

<p>
<code>body</code> is just a list and can be used/modified
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">defmacro</span> <span style="color: #fabd2f;">test-macro</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;rest</span> body<span style="color: #b16286;">)</span>
  `<span style="color: #b16286;">(</span>quote ,body<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
this is called an <b>anaphoric macro</b> where you wrap the body with a lexical function definition that shadows the global one
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp">CL-USER&gt; <span style="color: #458588;">(</span><span style="color: #fb4933;">defun</span> <span style="color: #fabd2f;">foo</span> <span style="color: #b16286;">()</span> 1<span style="color: #458588;">)</span>
FOO
CL-USER&gt; <span style="color: #458588;">(</span><span style="color: #fb4933;">defmacro</span> <span style="color: #fabd2f;">with-different-foo</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;body</span> body<span style="color: #b16286;">)</span>
           `<span style="color: #b16286;">(</span><span style="color: #fb4933;">flet</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>foo <span style="color: #458588;">()</span> 2<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
              ,@body<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
WITH-DIFFERENT-FOO
CL-USER&gt; <span style="color: #458588;">(</span><span style="color: #fb4933;">progn</span>
           <span style="color: #b16286;">(</span>foo<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
1
CL-USER&gt; <span style="color: #458588;">(</span><span style="color: #fb4933;">with-different-foo</span>
           <span style="color: #b16286;">(</span>foo<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
2
</pre>
</div>
</div>
</div>
<div id="outline-container-org29e5046" class="outline-2">
<h2 id="org29e5046">reader macros</h2>
<div class="outline-text-2" id="text-org29e5046">
<p>
the <code>#+</code> and <code>#-</code> <b>reader macros</b> are pretty nice for commenting out sexps. they allow ignoring the following sexp, if the given symbol isn't/is found in <code>*FEATURES*</code>. Just pick a symbol not in <code>*FEATURES*</code>, and use it with <code>#+</code> like this:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp">#+nil
<span style="color: #458588;">(</span><span style="color: #fb4933;">defun</span> <span style="color: #fabd2f;">foo</span> <span style="color: #b16286;">()</span>
  ...<span style="color: #458588;">)</span>
</pre>
</div>

<p>
Now, the function definition will be ignored (unless NIL is in <code>*FEATURES*</code>, which is not very likely).
</p>
</div>
</div>
<div id="outline-container-orge92fc05" class="outline-2">
<h2 id="orge92fc05">use double-floats by default</h2>
<div class="outline-text-2" id="text-orge92fc05">
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>setf *read-default-float-format* 'double-float<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org91e6311" class="outline-2">
<h2 id="org91e6311">enforce garbage collection</h2>
<div class="outline-text-2" id="text-org91e6311">
<p>
running
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>gc <span style="color: #fe8019;">:full</span> t<span style="color: #458588;">)</span>
</pre>
</div>

<p>
invokes the garbage collector
</p>
</div>
</div>
<div id="outline-container-org6f2cc27" class="outline-2">
<h2 id="org6f2cc27">checking equalities</h2>
<div class="outline-text-2" id="text-org6f2cc27">
<p>
some equality tests may return results that are implementation-specific, i dont list those here, i only wrote the ones that are supposed to work on any cl implementation
string equality:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>equal <span style="color: #b8bb26;">"foo"</span> <span style="color: #b16286;">(</span>copy-seq <span style="color: #b8bb26;">"foo"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
</pre>
</div>

<p>
symbol equality (any equality operator works for symbols):
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>eq 'foo 'foo<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
</pre>
</div>

<p>
number equality:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">'eql' is "type sensitive"</span>
<span style="color: #458588;">(</span>eql 3 3.0<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; NIL</span>
<span style="color: #458588;">(</span>eql 3 3<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">'equal' works for floats and integers all the same</span>
<span style="color: #458588;">(</span>equal 3 3.0<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
<span style="color: #458588;">(</span>equal 3 3<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">'equalp' works for floats and integers all the same</span>
<span style="color: #458588;">(</span>equalp 3 3.0<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
<span style="color: #458588;">(</span>equalp 3 3<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
</pre>
</div>

<p>
object equality (same object in memory):
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span>eq 'a 'a<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
<span style="color: #458588;">(</span>eq <span style="color: #b8bb26;">"foo"</span> <span style="color: #b16286;">(</span>copy-seq <span style="color: #b8bb26;">"foo"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; NIL</span>
<span style="color: #458588;">(</span>eq 3 3.0<span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; NIL</span>
</pre>
</div>

<p>
sequence equality (and general object equality which compares the internal structure):
uppercase and lowercase letters in strings are considered by <code>equal</code> to be distinct. in contrast, <code>equalp</code> ignores case distinctions in strings. <code>equalp</code> works for arrays but <code>equal</code> doesnt ("works" as in does element-wise comparison, which is the intended equality check here)
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">strings</span>
<span style="color: #458588;">(</span>equal <span style="color: #b8bb26;">"Foo"</span> <span style="color: #b16286;">(</span>copy-seq <span style="color: #b8bb26;">"Foo"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
<span style="color: #458588;">(</span>equal <span style="color: #b8bb26;">"Foo"</span> <span style="color: #b16286;">(</span>copy-seq <span style="color: #b8bb26;">"foo"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; NIL</span>
<span style="color: #458588;">(</span>equalp <span style="color: #b8bb26;">"Foo"</span> <span style="color: #b16286;">(</span>copy-seq <span style="color: #b8bb26;">"foo"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; NIL</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">vectors/arrays</span>
<span style="color: #458588;">(</span>equal #<span style="color: #b16286;">(</span>1 2 3<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>copy-seq #<span style="color: #8ec07c;">(</span>1 2 3<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; NIL</span>
<span style="color: #458588;">(</span>equalp #<span style="color: #b16286;">(</span>1 2 3<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>copy-seq #<span style="color: #8ec07c;">(</span>1 2 3<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">lists</span>
<span style="color: #458588;">(</span>equal '<span style="color: #b16286;">(</span>1 2 3<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>copy-seq '<span style="color: #8ec07c;">(</span>1 2 3<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
<span style="color: #458588;">(</span>equalp '<span style="color: #b16286;">(</span>1 2 3<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>copy-seq '<span style="color: #8ec07c;">(</span>1 2 3<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=&gt; T</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbb5f7ae" class="outline-2">
<h2 id="orgbb5f7ae">alist</h2>
<div class="outline-text-2" id="text-orgbb5f7ae">
<p>
we can append new pairs to an alist using <code>push</code> (there are many other ways):
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #458588;">(</span><span style="color: #fb4933;">let</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>my-alist '<span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>a . b<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>push <span style="color: #8ec07c;">(</span>cons 'x 'y<span style="color: #8ec07c;">)</span> my-alist<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>push '<span style="color: #8ec07c;">(</span>10 . 20<span style="color: #8ec07c;">)</span> my-alist<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>


<pre class="example">
((10 . 20) (X . Y) (A . B))
</pre>
</div>
</div>
<div id="outline-container-orgb21f112" class="outline-2">
<h2 id="orgb21f112">resources</h2>
<div class="outline-text-2" id="text-orgb21f112">
<p>
<a href="https://lisp-journey.gitlab.io/blog/common-lisp-macros-by-example-tutorial">https://lisp-journey.gitlab.io/blog/common-lisp-macros-by-example-tutorial</a>
<a href="https://taeric.github.io/CodeAsData.html">https://taeric.github.io/CodeAsData.html</a>
<a href="https://github.com/ghollisjr/cl-ana">https://github.com/ghollisjr/cl-ana</a>
<a href="https://github.com/marcoheisig/Petalisp">https://github.com/marcoheisig/Petalisp</a></p>
</div>
</div>
</div>
</body>
</html>
