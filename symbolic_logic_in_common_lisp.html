<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>symbolic logic in common lisp</title><!-- for google analytics -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QNNF19VZGH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QNNF19VZGH');
</script>

<!-- lambda icon, frail attempt -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%221em%22 font-size=%22100%22 color=%22red%22>Î»</text></svg>">
<!-- not-so-awesome awesome font -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="/main.css">
<!-- for dark mode -->
<script src="darkmode.js"></script>
<script src="main.js"></script>
<script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
<div id="preamble" class="status">
<div class="navbar">
  <a href='/'>home</a>
  <a href='/blog.html'>blog</a>
  <a href='/search.html'>search</a>
  <a href='/about.html'>about</a>
  <div id="darkModeToggle" onclick="toggleDarkMode()">
    &#9680; <!-- Circle with left half black -->
  </div>
</div>
<div class="toc">
  <span class="toc-title-container">
    <a class='feather' data-feather='menu'></a>
    <span class="toc-title">table of contents</span>
  </span>
  <div class="toc-list">
  </div>
</div><h1 class="main-title">symbolic logic in common lisp</h1><span class="desc">using the symbolic capabilities of lisp to write inference engines and more</span><span class='date'>2023-09-21</span>
</div>
<div id="content" class="content">
<p>
<a href="/logic_programming.html">logic programming</a> in <a href="/common_lisp.html">common lisp</a>
</p>
<div id="outline-container-org79ca7a2" class="outline-2">
<h2 id="org79ca7a2">logical statements</h2>
<div class="outline-text-2" id="text-org79ca7a2">
<p>
we make use of the symbolic capabilities of lisp, we use quoting and symbols to represent logical <a href="/statement.html">statement</a>s, e.g. given the following <a href="/knowledge_base.html">knowledge base</a> of <a href="/horn_clause.html">horn clause</a>s:
</p>

<div class="equation-container">
<span class="equation">
<?xml version='1.0' encoding='UTF-8'?>

<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='144.476098 -96.471556 78.251581 96.471556' style="max-height: 10.4472em; vertical-align: -0.4020em; display: inline-block" class="org-latex org-latex-inline">
<defs>
<path id='g0-41' d='m9.384807-2.49066c0-.079701-.049813-.099626-.159402-.129514c-1.594022-.448319-2.49066-1.454545-2.978829-2.361146c-.109589-.18929-.109589-.209215-.129514-.219178c-.039851-.029888-.089664-.029888-.14944-.029888c-.089664 0-.199253 0-.199253 .119552c0 0 .18929 .56787 .996264 1.454545h-5.877958c-.139477 0-.328767 0-.328767 .199253s.18929 .199253 .33873 .199253h6.136986c.159402 0 .179328 0 .308842 .099626c.468244 .348692 .936488 .577833 1.135741 .667497c-.209215 .089664-.667497 .318804-1.145704 .667497c-.119552 .099626-.139477 .099626-.298879 .099626h-6.136986c-.14944 0-.33873 0-.33873 .199253s.18929 .199253 .328767 .199253h5.877958c-.806974 .876712-.996264 1.424658-.996264 1.454545c0 .119552 .109589 .119552 .199253 .119552c.14944 0 .14944-.009963 .249066-.18929c.508095-.966376 1.424658-1.972603 2.998755-2.420922c.119552-.029888 .169365-.049813 .169365-.129514z'/>
<path id='g0-94' d='m6.07721 .019925c0-.029888 0-.049813-.059776-.169365l-2.480697-5.608966c-.039851-.099626-.089664-.199253-.219178-.199253c-.089664 0-.159402 .049813-.219178 .18929l-2.480697 5.618929c-.059776 .119552-.059776 .139477-.059776 .169365c0 .109589 .089664 .199253 .199253 .199253c.069738 0 .14944-.019925 .219178-.18929l2.34122-5.300125l2.34122 5.290162c.049813 .109589 .089664 .199253 .219178 .199253c.109589 0 .199253-.089664 .199253-.199253z'/>
<path id='g2-61' d='m7.183064-3.457036c0-.199253-.18929-.199253-.328767-.199253h-5.967621c-.139477 0-.328767 0-.328767 .199253s.18929 .199253 .33873 .199253h5.947696c.14944 0 .33873 0 .33873-.199253zm0 1.932752c0-.199253-.18929-.199253-.33873-.199253h-5.947696c-.14944 0-.33873 0-.33873 .199253s.18929 .199253 .328767 .199253h5.967621c.139477 0 .328767 0 .328767-.199253z'/>
<path id='g1-65' d='m7.183064-.199253c0-.109589-.099626-.109589-.229141-.109589c-.617684 0-.617684-.069738-.647572-.358655l-.607721-6.22665c-.019925-.199253-.019925-.239103-.18929-.239103c-.159402 0-.199253 .069738-.259029 .169365l-3.466999 5.818182c-.398506 .667497-.787049 .806974-1.225405 .836862c-.119552 .009963-.209215 .009963-.209215 .199253c0 .059776 .049813 .109589 .129514 .109589c.268991 0 .577833-.029888 .856787-.029888c.328767 0 .67746 .029888 .996264 .029888c.059776 0 .18929 0 .18929-.18929c0-.109589-.089664-.119552-.159402-.119552c-.229141-.019925-.468244-.099626-.468244-.348692c0-.119552 .059776-.229141 .139477-.368618c.069738-.119552 .079701-.119552 .757161-1.275218h2.500623c.019925 .209215 .159402 1.564134 .159402 1.663761c0 .298879-.518057 .328767-.71731 .328767c-.139477 0-.239103 0-.239103 .199253c0 .109589 .139477 .109589 .139477 .109589c.408468 0 .836862-.029888 1.24533-.029888c.249066 0 .876712 .029888 1.125778 .029888c.059776 0 .179328 0 .179328-.199253zm-1.92279-2.410959h-2.281445l1.96264-3.287671l.318804 3.287671z'/>
<path id='g1-66' d='m6.993773-2.15193c0-.71731-.577833-1.295143-1.544209-1.404732c1.036115-.18929 2.082192-.926526 2.082192-1.872976c0-.737235-.657534-1.374844-1.853051-1.374844h-3.347447c-.18929 0-.288917 0-.288917 .199253c0 .109589 .089664 .109589 .278954 .109589c0 0 .209215 0 .37858 .019925c.179328 .019925 .268991 .029888 .268991 .159402c0 .039851-.009963 .069738-.039851 .18929l-1.334994 5.349938c-.099626 .388543-.119552 .468244-.9066 .468244c-.169365 0-.268991 0-.268991 .199253c0 .109589 .089664 .109589 .268991 .109589h3.556663c1.574097 0 2.749689-1.175592 2.749689-2.15193zm-.368618-3.317559c0 .876712-.856787 1.823163-2.072229 1.823163h-1.454545l.617684-2.470735c.089664-.348692 .109589-.37858 .537983-.37858h1.285181c.876712 0 1.085928 .587796 1.085928 1.026152zm-.557908 3.20797c0 .986301-.886675 1.952677-2.062267 1.952677h-1.354919c-.139477 0-.159402 0-.219178-.009963c-.099626-.009963-.129514-.019925-.129514-.099626c0-.029888 0-.049813 .049813-.229141l.687422-2.779577h1.882939c.956413 0 1.145704 .737235 1.145704 1.165629z'/>
<path id='g1-76' d='m6.405978-2.460772c0-.039851-.029888-.109589-.119552-.109589s-.099626 .049813-.169365 .209215c-.33873 .916563-.777086 2.052304-2.500623 2.052304h-.936488c-.139477 0-.159402 0-.219178-.009963c-.099626-.009963-.129514-.019925-.129514-.099626c0-.029888 0-.049813 .049813-.229141l1.344956-5.379826c.089664-.358655 .119552-.468244 1.05604-.468244c.298879 0 .37858 0 .37858-.18929c0-.119552-.109589-.119552-.159402-.119552l-1.474471 .029888l-1.325031-.029888c-.069738 0-.18929 0-.18929 .199253c0 .109589 .089664 .109589 .278954 .109589c0 0 .209215 0 .37858 .019925c.179328 .019925 .268991 .029888 .268991 .159402c0 .039851-.009963 .069738-.039851 .18929l-1.334994 5.349938c-.099626 .388543-.119552 .468244-.9066 .468244c-.169365 0-.268991 0-.268991 .199253c0 .109589 .089664 .109589 .268991 .109589h4.612702c.239103 0 .249066 0 .308842-.169365l.787049-2.15193c.039851-.109589 .039851-.139477 .039851-.139477z'/>
<path id='g1-77' d='m8.777086-.199253c0-.109589-.089664-.109589-.278954-.109589c-.368618 0-.647572 0-.647572-.179328c0-.039851 0-.059776 .049813-.239103l1.325031-5.310087c.089664-.358655 .109589-.458281 .856787-.458281c.229141 0 .318804 0 .318804-.199253c0-.109589-.099626-.109589-.268991-.109589h-1.315068c-.259029 0-.268991 0-.388543 .18929l-3.636364 5.678705l-.777086-5.638854c-.029888-.229141-.049813-.229141-.308842-.229141h-1.364882c-.18929 0-.298879 0-.298879 .18929c0 .119552 .089664 .119552 .288917 .119552c.129514 0 .308842 .009963 .428394 .019925c.159402 .019925 .219178 .049813 .219178 .159402c0 .039851-.009963 .069738-.039851 .18929l-1.265255 5.070984c-.099626 .398506-.268991 .71731-1.075965 .747198c-.049813 0-.179328 .009963-.179328 .18929c0 .089664 .059776 .119552 .139477 .119552c.318804 0 .667497-.029888 .996264-.029888c.33873 0 .697385 .029888 1.026152 .029888c.049813 0 .179328 0 .179328-.199253c0-.109589-.109589-.109589-.179328-.109589c-.56787-.009963-.67746-.209215-.67746-.438356c0-.069738 .009963-.119552 .039851-.229141l1.354919-5.429639h.009963l.856787 6.176837c.019925 .119552 .029888 .229141 .14944 .229141c.109589 0 .169365-.109589 .219178-.179328l4.024907-6.306351h.009963l-1.424658 5.708593c-.099626 .388543-.119552 .468244-.9066 .468244c-.169365 0-.278954 0-.278954 .18929c0 .119552 .119552 .119552 .14944 .119552l1.235367-.029888c.408468 0 .836862 .029888 1.24533 .029888c.059776 0 .18929 0 .18929-.199253z'/>
<path id='g1-80' d='m7.511831-5.300125c0-.767123-.657534-1.504359-1.96264-1.504359h-3.227895c-.18929 0-.298879 0-.298879 .18929c0 .119552 .089664 .119552 .288917 .119552c.129514 0 .308842 .009963 .428394 .019925c.159402 .019925 .219178 .049813 .219178 .159402c0 .039851-.009963 .069738-.039851 .18929l-1.334994 5.349938c-.099626 .388543-.119552 .468244-.9066 .468244c-.169365 0-.278954 0-.278954 .18929c0 .119552 .119552 .119552 .14944 .119552l1.265255-.029888l.637609 .009963c.219178 0 .438356 .019925 .647572 .019925c.069738 0 .199253 0 .199253-.199253c0-.109589-.089664-.109589-.278954-.109589c-.368618 0-.647572 0-.647572-.179328c0-.059776 .019925-.109589 .029888-.169365l.617684-2.49066h1.693649c1.414695 0 2.799502-1.036115 2.799502-2.15193zm-.926526-.239103c0 .388543-.199253 1.24533-.587796 1.603985c-.498132 .448319-1.09589 .52802-1.534247 .52802h-1.404732l.67746-2.709838c.089664-.348692 .109589-.37858 .537983-.37858h.956413c.826899 0 1.354919 .268991 1.354919 .956413z'/>
<path id='g1-81' d='m6.465753 0c0-.069738-.069738-.099626-.109589-.099626c-.079701 0-.099626 .049813-.119552 .109589c-.239103 .707347-.816936 .956413-1.165629 .956413c-.458281 0-.607721-.268991-.707347-1.026152c1.544209-.587796 3.008717-2.361146 3.008717-4.283935c0-1.603985-1.05604-2.67995-2.540473-2.67995c-2.15193 0-4.343711 2.261519-4.343711 4.582814c0 1.653798 1.115816 2.660025 2.550436 2.660025c.249066 0 .587796-.039851 .976339-.14944c-.039851 .617684-.039851 .637609-.039851 .767123c0 .318804 0 1.09589 .826899 1.09589c1.185554 0 1.663761-1.823163 1.663761-1.932752zm.029888-4.662516c0 .996264-.508095 3.327522-2.181818 4.26401c-.049813-.348692-.14944-1.075965-.876712-1.075965c-.52802 0-1.016189 .498132-1.016189 1.016189c0 .199253 .059776 .318804 .059776 .318804c-.777086-.308842-1.115816-1.085928-1.115816-1.982565c0-.687422 .259029-2.102117 1.016189-3.178082c.727273-1.016189 1.663761-1.474471 2.391034-1.474471c.996264 0 1.723537 .777086 1.723537 2.11208zm-2.450809 4.254047c0 .14944-.009963 .159402-.109589 .199253c-.259029 .109589-.557908 .179328-.836862 .179328c-.139477 0-.458281 0-.458281-.428394c0-.398506 .37858-.797011 .797011-.797011s.607721 .239103 .607721 .846824z'/>
<path id='g1-83' d='m5.50934-2.34122c0-.687422-.33873-1.026152-.488169-1.165629c-.229141-.229141-.37858-.268991-1.265255-.498132l-.667497-.179328c-.268991-.089664-.607721-.37858-.607721-.9066c0-.806974 .797011-1.653798 1.743462-1.653798c.826899 0 1.43462 .428394 1.43462 1.544209c0 .318804-.039851 .498132-.039851 .557908c0 0 0 .099626 .119552 .099626c.099626 0 .109589-.029888 .14944-.199253l.537983-2.181818c0-.029888-.019925-.099626-.109589-.099626c-.049813 0-.059776 .009963-.179328 .14944l-.478207 .56787c-.259029-.468244-.777086-.71731-1.424658-.71731c-1.265255 0-2.460772 1.145704-2.460772 2.351183c0 .806974 .52802 1.265255 1.036115 1.414695l1.066002 .278954c.368618 .089664 .916563 .239103 .916563 1.05604c0 .896638-.816936 1.833126-1.793275 1.833126c-.637609 0-1.743462-.219178-1.743462-1.454545c0-.239103 .049813-.478207 .059776-.537983c.009963-.039851 .019925-.069738 .019925-.069738c0-.099626-.069738-.109589-.119552-.109589s-.069738 .009963-.099626 .039851c-.039851 .039851-.597758 2.311333-.597758 2.34122c0 .059776 .049813 .099626 .109589 .099626c.049813 0 .059776-.009963 .179328-.14944l.488169-.56787c.428394 .577833 1.105853 .71731 1.683686 .71731c1.354919 0 2.530511-1.325031 2.530511-2.560399z'/>
</defs>
<g id='page1'>
<g fill='currentColor'>
<use x='144.476098' y='-89.663761' xlink:href='#g1-80'/>
<use x='157.790625' y='-89.663761' xlink:href='#g2-61'/>
<use x='163.879163' y='-89.663761' xlink:href='#g0-41'/>
<use x='179.376496' y='-89.663761' xlink:href='#g1-81'/>
<use x='144.476098' y='-74.719801' xlink:href='#g1-76'/>
<use x='153.470111' y='-74.719801' xlink:href='#g0-94'/>
<use x='162.325759' y='-74.719801' xlink:href='#g1-77'/>
<use x='178.611767' y='-74.719801' xlink:href='#g2-61'/>
<use x='184.700305' y='-74.719801' xlink:href='#g0-41'/>
<use x='200.197638' y='-74.719801' xlink:href='#g1-80'/>
<use x='144.476098' y='-59.775841' xlink:href='#g1-66'/>
<use x='154.746572' y='-59.775841' xlink:href='#g0-94'/>
<use x='163.60222' y='-59.775841' xlink:href='#g1-76'/>
<use x='175.917032' y='-59.775841' xlink:href='#g2-61'/>
<use x='182.00557' y='-59.775841' xlink:href='#g0-41'/>
<use x='197.502904' y='-59.775841' xlink:href='#g1-77'/>
<use x='144.476098' y='-44.83188' xlink:href='#g1-65'/>
<use x='154.161963' y='-44.83188' xlink:href='#g0-94'/>
<use x='163.017611' y='-44.83188' xlink:href='#g1-80'/>
<use x='176.332138' y='-44.83188' xlink:href='#g2-61'/>
<use x='182.420676' y='-44.83188' xlink:href='#g0-41'/>
<use x='197.918009' y='-44.83188' xlink:href='#g1-76'/>
<use x='144.476098' y='-29.88792' xlink:href='#g1-65'/>
<use x='154.161963' y='-29.88792' xlink:href='#g0-94'/>
<use x='163.017611' y='-29.88792' xlink:href='#g1-66'/>
<use x='173.288085' y='-29.88792' xlink:href='#g0-94'/>
<use x='182.143734' y='-29.88792' xlink:href='#g1-83'/>
<use x='194.361661' y='-29.88792' xlink:href='#g2-61'/>
<use x='200.450199' y='-29.88792' xlink:href='#g0-41'/>
<use x='215.947532' y='-29.88792' xlink:href='#g1-76'/>
<use x='144.476098' y='-14.94396' xlink:href='#g1-65'/>
<use x='144.476098' y='0' xlink:href='#g1-66'/>
</g>
</g>
</svg>
</span>
<span class="caption"></span>
</div>
<p>
in lisp we could write it as:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defparameter</span> <span style="color: #ffaacf;">*kb*</span>
  '<span style="color: #ffaacf;">(</span><span style="color: #80aadf;">(</span>implies p q<span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span>implies <span style="color: #e47980;">(</span>and l m<span style="color: #e47980;">)</span> p<span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span>implies <span style="color: #e47980;">(</span>and b l<span style="color: #e47980;">)</span> m<span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span>implies <span style="color: #e47980;">(</span>and a p<span style="color: #e47980;">)</span> l<span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span>implies <span style="color: #e47980;">(</span>and a b s<span style="color: #e47980;">)</span> l<span style="color: #80aadf;">)</span>
    A
    B<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
*kb*
</pre>
</div>


<pre class="example">
((IMPLIES P Q) (IMPLIES (AND L M) P) (IMPLIES (AND B L) M)
 (IMPLIES (AND A P) L) (IMPLIES (AND A B S) L) A B)
</pre>


<p>
the choice of the symbols <code>implies, and</code> could vary, but essentially we should write code that deals properly with these symbols based on their names. other symbols we may use are <code>or, iff</code>.
</p>

<p>
so a knowledge base is just a (nested) list of <a href="/statement.html">proposition</a>s.
</p>

<p>
what about <a href="/predicate.html">predicate</a>s? e.g. statements like <?xml version='1.0' encoding='UTF-8'?>

<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 -7.47198 65.568208 9.96264' style="max-height: 1.0784em; vertical-align: -0.2942em; display: inline-block" class="org-latex org-latex-inline">
<defs>
<path id='g2-40' d='m3.297634 2.391034c0-.029888 0-.049813-.169365-.219178c-1.24533-1.255293-1.564134-3.138232-1.564134-4.662516c0-1.733499 .37858-3.466999 1.603985-4.712329c.129514-.119552 .129514-.139477 .129514-.169365c0-.069738-.039851-.099626-.099626-.099626c-.099626 0-.996264 .67746-1.58406 1.942715c-.508095 1.09589-.627646 2.201743-.627646 3.038605c0 .777086 .109589 1.982565 .657534 3.108344c.597758 1.225405 1.454545 1.872976 1.554172 1.872976c.059776 0 .099626-.029888 .099626-.099626z'/>
<path id='g2-41' d='m2.879203-2.49066c0-.777086-.109589-1.982565-.657534-3.108344c-.597758-1.225405-1.454545-1.872976-1.554172-1.872976c-.059776 0-.099626 .039851-.099626 .099626c0 .029888 0 .049813 .18929 .229141c.976339 .986301 1.544209 2.570361 1.544209 4.652553c0 1.703611-.368618 3.457036-1.603985 4.712329c-.129514 .119552-.129514 .139477-.129514 .169365c0 .059776 .039851 .099626 .099626 .099626c.099626 0 .996264-.67746 1.58406-1.942715c.508095-1.09589 .627646-2.201743 .627646-3.038605z'/>
<path id='g1-72' d='m7.153176-.199253c0-.109589-.089664-.109589-.278954-.109589c-.368618 0-.647572 0-.647572-.179328c0-.059776 .019925-.109589 .029888-.169365l1.344956-5.379826c.089664-.358655 .109589-.458281 .836862-.458281c.259029 0 .33873 0 .33873-.199253c0-.109589-.109589-.109589-.139477-.109589l-1.275218 .029888l-1.285181-.029888c-.079701 0-.18929 0-.18929 .199253c0 .109589 .089664 .109589 .278954 .109589c0 0 .209215 0 .37858 .019925c.179328 .019925 .268991 .029888 .268991 .159402c0 .039851-.009963 .059776-.039851 .18929l-.597758 2.430884h-3.038605l.587796-2.34122c.089664-.358655 .119552-.458281 .836862-.458281c.259029 0 .33873 0 .33873-.199253c0-.109589-.109589-.109589-.139477-.109589l-1.275218 .029888l-1.285181-.029888c-.079701 0-.18929 0-.18929 .199253c0 .109589 .089664 .109589 .278954 .109589c0 0 .209215 0 .37858 .019925c.179328 .019925 .268991 .029888 .268991 .159402c0 .039851-.009963 .069738-.039851 .18929l-1.334994 5.349938c-.099626 .388543-.119552 .468244-.9066 .468244c-.179328 0-.268991 0-.268991 .199253c0 .109589 .139477 .109589 .139477 .109589l1.265255-.029888l.637609 .009963c.219178 0 .438356 .019925 .647572 .019925c.079701 0 .199253 0 .199253-.199253c0-.109589-.089664-.109589-.278954-.109589c-.368618 0-.647572 0-.647572-.179328c0-.059776 .019925-.109589 .029888-.169365l.67746-2.729763h3.038605l-.687422 2.749689c-.099626 .318804-.288917 .328767-.9066 .328767c-.14944 0-.239103 0-.239103 .199253c0 .109589 .139477 .109589 .139477 .109589l1.265255-.029888l.637609 .009963c.219178 0 .438356 .019925 .647572 .019925c.079701 0 .199253 0 .199253-.199253z'/>
<path id='g1-74' d='m6.306351-6.684932c0-.089664-.059776-.119552-.139477-.119552c-.249066 0-.856787 .029888-1.105853 .029888l-1.464508-.029888c-.089664 0-.209215 0-.209215 .199253c0 .109589 .079701 .109589 .33873 .109589c.229141 0 .328767 0 .577833 .019925c.239103 .029888 .308842 .059776 .308842 .199253c0 .059776-.019925 .129514-.039851 .209215l-1.145704 4.572852c-.239103 .966376-.916563 1.494396-1.43462 1.494396c-.259029 0-.787049-.099626-.946451-.617684c.029888 .009963 .119552 .009963 .119552 .009963c.388543 0 .647572-.33873 .647572-.637609c0-.318804-.268991-.418431-.438356-.418431c-.179328 0-.667497 .119552-.667497 .797011c0 .617684 .52802 1.085928 1.315068 1.085928c.916563 0 1.952677-.657534 2.201743-1.643836l1.165629-4.652553c.079701-.328767 .099626-.418431 .647572-.418431c.159402 0 .268991 0 .268991-.18929z'/>
<path id='g1-97' d='m4.961395-1.424658c0-.099626-.089664-.099626-.119552-.099626c-.099626 0-.109589 .039851-.139477 .179328c-.169365 .647572-.348692 1.235367-.757161 1.235367c-.268991 0-.298879-.259029-.298879-.458281c0-.219178 .019925-.298879 .129514-.737235l.219178-.896638l.358655-1.39477c.069738-.278954 .069738-.298879 .069738-.33873c0-.169365-.119552-.268991-.288917-.268991c-.239103 0-.388543 .219178-.418431 .438356c-.179328-.368618-.468244-.637609-.916563-.637609c-1.165629 0-2.400996 1.464508-2.400996 2.919054c0 .936488 .547945 1.594022 1.325031 1.594022c.199253 0 .697385-.039851 1.295143-.747198c.079701 .418431 .428394 .747198 .9066 .747198c.348692 0 .577833-.229141 .737235-.547945c.169365-.358655 .298879-.986301 .298879-.986301zm-1.39477-1.713574l-.498132 1.952677c-.049813 .179328-.049813 .199253-.199253 .368618c-.438356 .547945-.846824 .707347-1.125778 .707347c-.498132 0-.637609-.547945-.637609-.936488c0-.498132 .318804-1.723537 .547945-2.181818c.308842-.587796 .757161-.956413 1.155666-.956413c.647572 0 .787049 .816936 .787049 .876712s-.019925 .119552-.029888 .169365z'/>
<path id='g1-104' d='m5.439601-1.424658c0-.099626-.089664-.099626-.119552-.099626c-.099626 0-.099626 .029888-.14944 .179328c-.14944 .52802-.468244 1.235367-1.016189 1.235367c-.169365 0-.239103-.099626-.239103-.328767c0-.249066 .089664-.488169 .179328-.707347c.159402-.428394 .607721-1.613948 .607721-2.191781c0-.647572-.398506-1.066002-1.145704-1.066002c-.627646 0-1.105853 .308842-1.474471 .767123l.777086-3.16812c0 0 0-.109589-.129514-.109589c-.229141 0-.956413 .079701-1.215442 .099626c-.079701 .009963-.18929 .019925-.18929 .199253c0 .119552 .089664 .119552 .239103 .119552c.478207 0 .498132 .069738 .498132 .169365l-.029888 .199253l-1.444583 5.738481c-.039851 .139477-.039851 .159402-.039851 .219178c0 .229141 .199253 .278954 .288917 .278954c.159402 0 .318804-.119552 .368618-.259029l.18929-.757161l.219178-.896638c.059776-.219178 .119552-.438356 .169365-.667497c.019925-.059776 .099626-.388543 .109589-.448319c.029888-.089664 .33873-.647572 .67746-.916563c.219178-.159402 .52802-.348692 .956413-.348692s.537983 .33873 .537983 .697385c0 .537983-.37858 1.62391-.617684 2.231631c-.079701 .229141-.129514 .348692-.129514 .547945c0 .468244 .348692 .816936 .816936 .816936c.936488 0 1.305106-1.454545 1.305106-1.534247z'/>
<path id='g1-109' d='m8.448319-1.424658c0-.099626-.089664-.099626-.119552-.099626c-.099626 0-.099626 .029888-.14944 .179328c-.14944 .52802-.468244 1.235367-1.016189 1.235367c-.169365 0-.239103-.099626-.239103-.328767c0-.249066 .089664-.488169 .179328-.707347c.18929-.518057 .607721-1.62391 .607721-2.191781c0-.647572-.398506-1.066002-1.145704-1.066002s-1.255293 .438356-1.62391 .966376c-.009963-.129514-.039851-.468244-.318804-.707347c-.249066-.209215-.56787-.259029-.816936-.259029c-.896638 0-1.384807 .637609-1.554172 .86675c-.049813-.56787-.468244-.86675-.916563-.86675c-.458281 0-.647572 .388543-.737235 .56787c-.179328 .348692-.308842 .936488-.308842 .966376c0 .099626 .119552 .099626 .119552 .099626c.099626 0 .109589-.009963 .169365-.229141c.169365-.707347 .368618-1.185554 .727273-1.185554c.159402 0 .308842 .079701 .308842 .458281c0 .209215-.029888 .318804-.159402 .836862l-.577833 2.30137c-.029888 .14944-.089664 .37858-.089664 .428394c0 .179328 .139477 .268991 .288917 .268991c.119552 0 .298879-.079701 .368618-.278954c.009963-.019925 .129514-.488169 .18929-.737235l.219178-.896638c.059776-.219178 .119552-.438356 .169365-.667497l.129514-.498132c.14944-.308842 .67746-1.215442 1.62391-1.215442c.448319 0 .537983 .368618 .537983 .697385c0 .249066-.069738 .52802-.14944 .826899l-.278954 1.155666c-.099626 .368618-.109589 .428394-.199253 .757161c-.039851 .199253-.129514 .537983-.129514 .587796c0 .179328 .139477 .268991 .288917 .268991c.308842 0 .368618-.249066 .448319-.56787l.597758-2.400996c.029888-.129514 .557908-1.325031 1.643836-1.325031c.428394 0 .537983 .33873 .537983 .697385c0 .56787-.418431 1.703611-.617684 2.231631c-.089664 .239103-.129514 .348692-.129514 .547945c0 .468244 .348692 .816936 .816936 .816936c.936488 0 1.305106-1.454545 1.305106-1.534247z'/>
<path id='g1-110' d='m5.688667-1.424658c0-.099626-.089664-.099626-.119552-.099626c-.099626 0-.099626 .029888-.14944 .179328c-.199253 .67746-.52802 1.235367-1.016189 1.235367c-.169365 0-.239103-.099626-.239103-.328767c0-.249066 .089664-.488169 .179328-.707347c.18929-.52802 .607721-1.62391 .607721-2.191781c0-.667497-.428394-1.066002-1.145704-1.066002c-.896638 0-1.384807 .637609-1.554172 .86675c-.049813-.557908-.458281-.86675-.916563-.86675s-.647572 .388543-.747198 .56787c-.159402 .33873-.298879 .926526-.298879 .966376c0 .099626 .119552 .099626 .119552 .099626c.099626 0 .109589-.009963 .169365-.229141c.169365-.707347 .368618-1.185554 .727273-1.185554c.199253 0 .308842 .129514 .308842 .458281c0 .209215-.029888 .318804-.159402 .836862l-.577833 2.30137c-.029888 .14944-.089664 .37858-.089664 .428394c0 .179328 .139477 .268991 .288917 .268991c.119552 0 .298879-.079701 .368618-.278954c.009963-.019925 .129514-.488169 .18929-.737235l.219178-.896638c.059776-.219178 .119552-.438356 .169365-.667497l.129514-.498132c.14944-.308842 .67746-1.215442 1.62391-1.215442c.448319 0 .537983 .368618 .537983 .697385c0 .617684-.488169 1.892902-.647572 2.321295c-.089664 .229141-.099626 .348692-.099626 .458281c0 .468244 .348692 .816936 .816936 .816936c.936488 0 1.305106-1.454545 1.305106-1.534247z'/>
<path id='g1-111' d='m4.672478-2.719801c0-1.036115-.697385-1.683686-1.594022-1.683686c-1.334994 0-2.669988 1.414695-2.669988 2.82939c0 .986301 .667497 1.683686 1.594022 1.683686c1.325031 0 2.669988-1.374844 2.669988-2.82939zm-.727273-.388543c0 .388543-.199253 1.43462-.577833 2.082192c-.348692 .577833-.896638 .916563-1.354919 .916563c-.428394 0-.86675-.308842-.86675-1.085928c0-.488169 .259029-1.564134 .577833-2.072229c.498132-.767123 1.066002-.916563 1.344956-.916563c.577833 0 .876712 .478207 .876712 1.075965z'/>
<path id='g1-117' d='m5.409714-1.424658c0-.099626-.089664-.099626-.119552-.099626c-.099626 0-.109589 .039851-.139477 .179328c-.139477 .557908-.328767 1.235367-.747198 1.235367c-.209215 0-.308842-.129514-.308842-.458281c0-.219178 .119552-.687422 .199253-1.036115l.278954-1.075965c.029888-.14944 .129514-.52802 .169365-.67746c.049813-.229141 .14944-.607721 .14944-.667497c0-.179328-.139477-.268991-.288917-.268991c-.049813 0-.308842 .009963-.388543 .348692l-.747198 2.998755c-.009963 .039851-.408468 .836862-1.135741 .836862c-.518057 0-.617684-.448319-.617684-.816936c0-.557908 .278954-1.344956 .537983-2.032379c.119552-.298879 .169365-.438356 .169365-.627646c0-.448319-.318804-.816936-.816936-.816936c-.946451 0-1.315068 1.444583-1.315068 1.534247c0 .099626 .119552 .099626 .119552 .099626c.099626 0 .109589-.019925 .159402-.179328c.249066-.86675 .627646-1.235367 1.006227-1.235367c.089664 0 .249066 .009963 .249066 .328767c0 .239103-.109589 .52802-.169365 .67746c-.368618 .986301-.577833 1.603985-.577833 2.092154c0 .946451 .687422 1.195517 1.225405 1.195517c.657534 0 1.016189-.448319 1.185554-.667497c.109589 .408468 .458281 .667497 .886675 .667497c.348692 0 .577833-.229141 .737235-.547945c.169365-.358655 .298879-.986301 .298879-.986301z'/>
</defs>
<g id='page2'>
<g fill='currentColor'>
<use x='0' y='0' xlink:href='#g1-72'/>
<use x='9.09089' y='0' xlink:href='#g1-117'/>
<use x='14.794086' y='0' xlink:href='#g1-109'/>
<use x='23.541419' y='0' xlink:href='#g1-97'/>
<use x='28.807573' y='0' xlink:href='#g1-110'/>
<use x='34.787498' y='0' xlink:href='#g2-40'/>
<use x='38.661977' y='0' xlink:href='#g1-74'/>
<use x='45.144613' y='0' xlink:href='#g1-111'/>
<use x='49.973735' y='0' xlink:href='#g1-104'/>
<use x='55.713805' y='0' xlink:href='#g1-110'/>
<use x='61.69373' y='0' xlink:href='#g2-41'/>
</g>
</g>
</svg>?, that should be simple enough, we just use <code>'(Human John)</code>, so instead of <b>infix notation</b>, we use lisp's infamous <b>prefix notation</b>, we dont need to worry about <code>(Human John)</code> sharing the same form as <code>(and x1 x2)</code>, as <code>and</code> can be considered just a boolean function like <code>Human</code>, after all. any expression that is in the form <code>(whatever x1 x2 ... xn)</code> would imply that <code>whatever</code> is meant to be treated as a boolean function.
</p>

<p>
first obstacle we may face is the issue of distinguishing a variable from a <a href="/scalar.html">constant</a> symbol, how can we tell whether a symbol represents a variable or a constant (an immutable object)? after all both are just symbols (in our implementation), for example consider <code>person</code> vs <code>John</code>, inherently, <code>person</code> is a variable that applies to everyone and <code>John</code> is a constant that only describes one person (in a simplified context where John refers to a friend, for example). a simple solution to this problem would be to use special syntax for variables, like <code>?x</code>, here, <code>?x</code> would mean we're dealing with a variable, and a symbol without a question mark prefix, for example <code>x</code>, is recognized as a constant.
</p>

<p>
in our previous example, this doesnt make much difference as we were dealing with constants only, consider this example which demonstrates how we apply the idea of prefixing variables with a question mark:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defparameter</span> <span style="color: #ffaacf;">*kb*</span>
  '<span style="color: #ffaacf;">(</span><span style="color: #80aadf;">(</span>person john<span style="color: #80aadf;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">person(john)</span>
    <span style="color: #80aadf;">(</span>implies <span style="color: #e47980;">(</span>person ?x<span style="color: #e47980;">)</span> <span style="color: #e47980;">(</span>human ?x<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">person(x) =&gt; human(x)</span>
    <span style="color: #80aadf;">(</span>implies <span style="color: #e47980;">(</span>and <span style="color: #d0b0ff;">(</span>not <span style="color: #3fc489;">(</span>widower ?x<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span> <span style="color: #d0b0ff;">(</span>father ?x<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span> <span style="color: #e47980;">(</span>married ?x<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
*kb*
</pre>
</div>


<pre class="example">
((PERSON JOHN) (IMPLIES (PERSON ?X) (HUMAN ?X))
 (IMPLIES (AND (NOT (WIDOWER ?X)) (FATHER ?X)) (MARRIED ?X)))
</pre>


<p>
how about substitutions? how do we represent for example the substitution <?xml version='1.0' encoding='UTF-8'?>

<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 -7.47198 67.513196 9.96264' style="max-height: 1.0784em; vertical-align: -0.2942em; display: inline-block" class="org-latex org-latex-inline">
<defs>
<path id='g2-50' d='m4.473225-1.733499h-.249066c-.049813 .298879-.119552 .737235-.219178 .886675c-.069738 .079701-.727273 .079701-.946451 .079701h-1.793275l1.05604-1.026152c1.554172-1.374844 2.15193-1.912827 2.15193-2.909091c0-1.135741-.896638-1.932752-2.11208-1.932752c-1.125778 0-1.863014 .916563-1.863014 1.803238c0 .557908 .498132 .557908 .52802 .557908c.169365 0 .518057-.119552 .518057-.52802c0-.259029-.179328-.518057-.52802-.518057c-.079701 0-.099626 0-.129514 .009963c.229141-.647572 .767123-1.016189 1.344956-1.016189c.9066 0 1.334994 .806974 1.334994 1.62391c0 .797011-.498132 1.58406-1.046077 2.201743l-1.912827 2.132005c-.109589 .109589-.109589 .129514-.109589 .368618h3.696139l.278954-1.733499z'/>
<path id='g1-59' d='m2.022416-.009963c0-.657534-.249066-1.046077-.637609-1.046077c-.328767 0-.52802 .249066-.52802 .52802c0 .268991 .199253 .52802 .52802 .52802c.119552 0 .249066-.039851 .348692-.129514c.029888-.019925 .049813-.029888 .049813-.029888s.019925 .009963 .019925 .14944c0 .737235-.348692 1.334994-.67746 1.663761c-.109589 .109589-.109589 .129514-.109589 .159402c0 .069738 .049813 .109589 .099626 .109589c.109589 0 .9066-.767123 .9066-1.932752z'/>
<path id='g1-61' d='m4.423412-7.272727c0-.109589-.089664-.199253-.199253-.199253c-.069738 0-.139477 .029888-.169365 .089664l-3.457036 9.494396c-.049813 .129514-.049813 .179328-.049813 .179328c0 .109589 .089664 .199253 .199253 .199253c.129514 0 .159402-.069738 .219178-.239103l3.407223-9.344956c.049813-.129514 .049813-.179328 .049813-.179328z'/>
<path id='g1-97' d='m4.961395-1.424658c0-.099626-.089664-.099626-.119552-.099626c-.099626 0-.109589 .039851-.139477 .179328c-.169365 .647572-.348692 1.235367-.757161 1.235367c-.268991 0-.298879-.259029-.298879-.458281c0-.219178 .019925-.298879 .129514-.737235l.219178-.896638l.358655-1.39477c.069738-.278954 .069738-.298879 .069738-.33873c0-.169365-.119552-.268991-.288917-.268991c-.239103 0-.388543 .219178-.418431 .438356c-.179328-.368618-.468244-.637609-.916563-.637609c-1.165629 0-2.400996 1.464508-2.400996 2.919054c0 .936488 .547945 1.594022 1.325031 1.594022c.199253 0 .697385-.039851 1.295143-.747198c.079701 .418431 .428394 .747198 .9066 .747198c.348692 0 .577833-.229141 .737235-.547945c.169365-.358655 .298879-.986301 .298879-.986301zm-1.39477-1.713574l-.498132 1.952677c-.049813 .179328-.049813 .199253-.199253 .368618c-.438356 .547945-.846824 .707347-1.125778 .707347c-.498132 0-.637609-.547945-.637609-.936488c0-.498132 .318804-1.723537 .547945-2.181818c.308842-.587796 .757161-.956413 1.155666-.956413c.647572 0 .787049 .816936 .787049 .876712s-.019925 .119552-.029888 .169365z'/>
<path id='g1-108' d='m2.391034-1.424658c0-.099626-.089664-.099626-.119552-.099626c-.099626 0-.109589 .039851-.139477 .179328c-.169365 .647572-.358655 1.235367-.757161 1.235367c-.298879 0-.298879-.318804-.298879-.458281c0-.239103 .009963-.288917 .059776-.478207l1.43462-5.758406c0 0 0-.109589-.129514-.109589c-.229141 0-.956413 .079701-1.215442 .099626c-.079701 .009963-.18929 .019925-.18929 .209215c0 .109589 .099626 .109589 .249066 .109589c.478207 0 .488169 .089664 .488169 .169365l-.029888 .199253l-1.255293 4.98132c-.029888 .109589-.049813 .179328-.049813 .33873c0 .56787 .438356 .916563 .9066 .916563c.328767 0 .577833-.199253 .747198-.557908c.179328-.37858 .298879-.976339 .298879-.976339z'/>
<path id='g1-118' d='m4.662516-3.706102c0-.537983-.259029-.697385-.438356-.697385c-.249066 0-.488169 .259029-.488169 .478207c0 .129514 .049813 .18929 .159402 .298879c.209215 .199253 .33873 .458281 .33873 .816936c0 .418431-.607721 2.699875-1.77335 2.699875c-.508095 0-.737235-.348692-.737235-.86675c0-.557908 .268991-1.285181 .577833-2.11208c.069738-.169365 .119552-.308842 .119552-.498132c0-.448319-.318804-.816936-.816936-.816936c-.936488 0-1.315068 1.444583-1.315068 1.534247c0 .099626 .119552 .099626 .119552 .099626c.099626 0 .109589-.019925 .159402-.179328c.288917-1.006227 .71731-1.235367 1.006227-1.235367c.079701 0 .249066 0 .249066 .318804c0 .249066-.099626 .518057-.169365 .697385c-.438356 1.155666-.56787 1.613948-.56787 2.042341c0 1.075965 .876712 1.235367 1.334994 1.235367c1.673724 0 2.241594-3.297634 2.241594-3.815691z'/>
<path id='g1-120' d='m4.941469-1.424658c0-.099626-.089664-.099626-.119552-.099626c-.089664 0-.109589 .039851-.129514 .109589c-.328767 1.066002-1.006227 1.305106-1.325031 1.305106c-.388543 0-.547945-.318804-.547945-.657534c0-.219178 .059776-.438356 .169365-.876712l.33873-1.364882c.059776-.259029 .288917-1.175592 .986301-1.175592c.049813 0 .288917 0 .498132 .129514c-.278954 .049813-.478207 .298879-.478207 .537983c0 .159402 .109589 .348692 .37858 .348692c.219178 0 .537983-.179328 .537983-.577833c0-.518057-.587796-.657534-.926526-.657534c-.577833 0-.926526 .52802-1.046077 .757161c-.249066-.657534-.787049-.757161-1.075965-.757161c-1.036115 0-1.603985 1.285181-1.603985 1.534247c0 .099626 .119552 .099626 .119552 .099626c.079701 0 .109589-.019925 .129514-.109589c.33873-1.05604 .996264-1.305106 1.334994-1.305106c.18929 0 .537983 .089664 .537983 .667497c0 .308842-.169365 .976339-.537983 2.371108c-.159402 .617684-.508095 1.036115-.946451 1.036115c-.059776 0-.288917 0-.498132-.129514c.249066-.049813 .468244-.259029 .468244-.537983c0-.268991-.219178-.348692-.368618-.348692c-.298879 0-.547945 .259029-.547945 .577833c0 .458281 .498132 .657534 .936488 .657534c.657534 0 1.016189-.697385 1.046077-.757161c.119552 .368618 .478207 .757161 1.075965 .757161c1.026152 0 1.594022-1.285181 1.594022-1.534247z'/>
<path id='g1-121' d='m4.841843-3.795766c.039851-.139477 .039851-.159402 .039851-.229141c0-.179328-.139477-.268991-.288917-.268991c-.099626 0-.259029 .059776-.348692 .209215c-.019925 .049813-.099626 .358655-.139477 .537983l-.199253 .797011l-.448319 1.793275c-.039851 .14944-.468244 .846824-1.125778 .846824c-.508095 0-.617684-.438356-.617684-.806974c0-.458281 .169365-1.075965 .508095-1.952677c.159402-.408468 .199253-.518057 .199253-.71731c0-.448319-.318804-.816936-.816936-.816936c-.946451 0-1.315068 1.444583-1.315068 1.534247c0 .099626 .119552 .099626 .119552 .099626c.099626 0 .109589-.019925 .159402-.179328c.268991-.936488 .667497-1.235367 1.006227-1.235367c.079701 0 .249066 0 .249066 .318804c0 .249066-.099626 .508095-.169365 .697385c-.398506 1.05604-.577833 1.62391-.577833 2.092154c0 .886675 .627646 1.185554 1.215442 1.185554c.388543 0 .727273-.169365 1.006227-.448319c-.129514 .518057-.249066 1.006227-.647572 1.534247c-.259029 .33873-.637609 .627646-1.09589 .627646c-.139477 0-.587796-.029888-.757161-.418431c.159402 0 .288917 0 .428394-.119552c.099626-.089664 .199253-.219178 .199253-.408468c0-.308842-.268991-.348692-.368618-.348692c-.229141 0-.557908 .159402-.557908 .647572c0 .498132 .438356 .86675 1.05604 .86675c1.026152 0 2.052304-.9066 2.331258-2.032379l.956413-3.805729z'/>
<path id='g0-102' d='m4.254047 2.381071c0-.099626-.059776-.099626-.159402-.109589c-.787049-.049813-1.155666-.498132-1.24533-.856787c-.029888-.109589-.029888-.129514-.029888-.478207v-1.494396c0-.298879 0-.806974-.019925-.9066c-.129514-.657534-.767123-.916563-1.155666-1.026152c1.175592-.33873 1.175592-1.046077 1.175592-1.325031v-1.793275c0-.71731 0-.936488 .239103-1.185554c.179328-.179328 .408468-.418431 1.105853-.458281c.049813-.009963 .089664-.049813 .089664-.109589c0-.109589-.079701-.109589-.199253-.109589c-.996264 0-1.882939 .508095-1.902864 1.225405v1.823163c0 .936488 0 1.09589-.259029 1.374844c-.139477 .139477-.408468 .408468-1.036115 .448319c-.069738 0-.139477 .009963-.139477 .109589s.059776 .099626 .159402 .109589c.428394 .029888 1.275218 .239103 1.275218 1.235367v1.972603c0 .577833 0 .916563 .518057 1.285181c.428394 .298879 1.075965 .37858 1.384807 .37858c.119552 0 .199253 0 .199253-.109589z'/>
<path id='g0-103' d='m4.254047-2.49066c0-.099626-.059776-.099626-.159402-.109589c-.428394-.029888-1.275218-.239103-1.275218-1.235367v-1.972603c0-.577833 0-.916563-.518057-1.285181c-.428394-.288917-1.066002-.37858-1.384807-.37858c-.099626 0-.199253 0-.199253 .109589c0 .099626 .059776 .099626 .159402 .109589c.787049 .049813 1.155666 .498132 1.24533 .856787c.029888 .109589 .029888 .129514 .029888 .478207v1.494396c0 .298879 0 .806974 .019925 .9066c.129514 .657534 .767123 .916563 1.155666 1.026152c-1.175592 .33873-1.175592 1.046077-1.175592 1.325031v1.793275c0 .71731 0 .936488-.239103 1.185554c-.179328 .179328-.408468 .418431-1.105853 .458281c-.049813 .009963-.089664 .049813-.089664 .109589c0 .109589 .099626 .109589 .199253 .109589c.996264 0 1.882939-.508095 1.902864-1.225405v-1.823163c0-.936488 0-1.09589 .259029-1.374844c.139477-.139477 .408468-.408468 1.036115-.448319c.069738 0 .139477-.009963 .139477-.109589z'/>
</defs>
<g id='page3'>
<g fill='currentColor'>
<use x='0' y='0' xlink:href='#g0-102'/>
<use x='4.981339' y='0' xlink:href='#g1-120'/>
<use x='10.675271' y='0' xlink:href='#g1-61'/>
<use x='15.65661' y='0' xlink:href='#g1-118'/>
<use x='20.843181' y='0' xlink:href='#g1-97'/>
<use x='26.109335' y='0' xlink:href='#g1-108'/>
<use x='29.278029' y='0' xlink:href='#g1-59'/>
<use x='33.705837' y='0' xlink:href='#g1-121'/>
<use x='38.94778' y='0' xlink:href='#g1-61'/>
<use x='43.929119' y='0' xlink:href='#g1-118'/>
<use x='49.11569' y='0' xlink:href='#g1-97'/>
<use x='54.381843' y='0' xlink:href='#g1-108'/>
<use x='57.550537' y='0' xlink:href='#g2-50'/>
<use x='62.531857' y='0' xlink:href='#g0-103'/>
</g>
</g>
</svg>, we just use an <a href="/common_lisp.html">association list</a>:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #ffaacf;">(</span><span style="color: #80aadf;">(</span>sub nil<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">sub is the substitution</span>
  <span style="color: #ffaacf;">(</span>push <span style="color: #80aadf;">(</span>cons '?x 'val1<span style="color: #80aadf;">)</span> sub<span style="color: #ffaacf;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">add pair using push</span>
  <span style="color: #ffaacf;">(</span>push <span style="color: #80aadf;">(</span>cons '?y 'val2<span style="color: #80aadf;">)</span> sub<span style="color: #ffaacf;">)</span>
  sub<span style="color: #deb07a;">)</span>
</pre>
</div>


<pre class="example">
((?Y . VAL2) (?X . VAL1))
</pre>
</div>
</div>
<div id="outline-container-org5959eef" class="outline-2">
<h2 id="org5959eef">early <a href="/inference_engine.html">inference engine</a>s</h2>
<div class="outline-text-2" id="text-org5959eef">
<p>
imma start off with the <a href="/unification.html">unification</a> algorithm, this one differs a bit from the pseudocode version, as it doesnt apply the <b>occur check</b> and doesnt distinguish between a compound statement or a list of expressions, as they are only used to represent predicates
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">variable?</span> <span style="color: #ffaacf;">(</span>x<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"return whether an expression is a variable"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #80aadf;">(</span>atom x<span style="color: #80aadf;">)</span>
      <span style="color: #80aadf;">(</span>equal <span style="color: #e47980;">(</span>char <span style="color: #d0b0ff;">(</span>symbol-name x<span style="color: #d0b0ff;">)</span> 0<span style="color: #e47980;">)</span> #\?<span style="color: #80aadf;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">if symbol starts with a question mark</span>
      nil<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">compound?</span> <span style="color: #ffaacf;">(</span>obj<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"whether an object is compound, or simply whether its a cons cell or not '(atom obj)' returns false for a cons cell"</span>
  <span style="color: #ffaacf;">(</span>not <span style="color: #80aadf;">(</span>atom obj<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">unify</span> <span style="color: #ffaacf;">(</span>x y <span style="color: #a9c99f;">&amp;optional</span> <span style="color: #80aadf;">(</span>sub nil<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"x,y are logical statements, sub is the substitution, sub is initalized to `</span><span style="color: #80aadf; font-style: italic;">nil</span><span style="color: #caa89f; font-style: italic;">', if it ever becomes `</span><span style="color: #80aadf; font-style: italic;">failure</span><span style="color: #caa89f; font-style: italic;">', it means we've failed to find a substitution, we return `</span><span style="color: #80aadf; font-style: italic;">failure</span><span style="color: #caa89f; font-style: italic;">' (symbol), otherwise we return a substitution (could be `</span><span style="color: #80aadf; font-style: italic;">nil</span><span style="color: #caa89f; font-style: italic;">' which denotes an empty substitution)"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #80aadf;">(</span>equal sub 'failure<span style="color: #80aadf;">)</span>
      'failure
      <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #e47980;">(</span>equal x y<span style="color: #e47980;">)</span>
          sub
          <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #d0b0ff;">(</span>variable? x<span style="color: #d0b0ff;">)</span>
              <span style="color: #d0b0ff;">(</span>unify-var x y sub<span style="color: #d0b0ff;">)</span>
              <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #3fc489;">(</span>variable? y<span style="color: #3fc489;">)</span>
                  <span style="color: #3fc489;">(</span>unify-var y x sub<span style="color: #3fc489;">)</span>
                  <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #6fb3c0;">(</span>and <span style="color: #c0b24f;">(</span>compound? x<span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>compound? y<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                      <span style="color: #6fb3c0;">(</span>unify <span style="color: #c0b24f;">(</span>rest x<span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>rest y<span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>unify <span style="color: #f3a0a0;">(</span>first x<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>first y<span style="color: #f3a0a0;">)</span> sub<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                      'failure<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">failure</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">unify-var</span> <span style="color: #ffaacf;">(</span>var x <span style="color: #a9c99f;">&amp;optional</span> <span style="color: #80aadf;">(</span>sub t<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"returns a substitution"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let*</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>sub-entry <span style="color: #d0b0ff;">(</span>assoc var sub<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">an entry in the substitution that corresponds to var, if no such entry exists, both sub-entry and val will be nil</span>
         <span style="color: #e47980;">(</span>val <span style="color: #d0b0ff;">(</span>cdr sub-entry<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> sub-entry
        <span style="color: #e47980;">(</span>unify val x sub<span style="color: #e47980;">)</span>
        <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #d0b0ff;">(</span>assoc x sub<span style="color: #d0b0ff;">)</span>
            <span style="color: #d0b0ff;">(</span>unify var val sub<span style="color: #d0b0ff;">)</span>
            <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">(if (occur-check? var x) ;; occur check, not implemented</span>
            <span style="color: #a0a0cf; font-style: italic;">;;     </span><span style="color: #a0a0cf; font-style: italic;">'failure</span>
            <span style="color: #a0a0cf; font-style: italic;">;;     </span><span style="color: #a0a0cf; font-style: italic;">(push (cons var x) sub))))))</span>
            <span style="color: #d0b0ff;">(</span>push <span style="color: #3fc489;">(</span>cons var x<span style="color: #3fc489;">)</span> sub<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">unify-success?</span> <span style="color: #ffaacf;">(</span>unify-out<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"check whether the value returned by `</span><span style="color: #80aadf; font-style: italic;">unify</span><span style="color: #caa89f; font-style: italic;">' represents a proper substitution and not a failure"</span>
  <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">(listp unify-out) ;; alternative solution</span>
  <span style="color: #ffaacf;">(</span>not <span style="color: #80aadf;">(</span>eq unify-out 'failure<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<p>
a test:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span>unify '<span style="color: #ffaacf;">(</span>person john<span style="color: #ffaacf;">)</span> '<span style="color: #ffaacf;">(</span>person ?x<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>


<pre class="example">
((?X . JOHN))
</pre>


<p>
next up, we need to implement <a href="/forward_chaining.html">forward chaining</a> and <a href="/backward_chaining.html">backward chaining</a> which take in a knowledge base of statements which are <a href="/definite_clause.html">definite clause</a>s and do <a href="/inference_algorithm.html">algorithmic inference</a>, this code makes use of <a href="/common_lisp_math_utils.html">common lisp math utils</a>
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">find-variables-in-statement</span> <span style="color: #ffaacf;">(</span>statement<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"find the variables in the list `</span><span style="color: #80aadf; font-style: italic;">statement</span><span style="color: #caa89f; font-style: italic;">' (variables are symbols that start with '?')"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>vars<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for myelt in statement do
      <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #d0b0ff;">(</span>variable? myelt<span style="color: #d0b0ff;">)</span>
          <span style="color: #d0b0ff;">(</span>setf vars <span style="color: #3fc489;">(</span>union <span style="color: #6fb3c0;">(</span>list myelt<span style="color: #6fb3c0;">)</span> vars<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
          <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">when</span> <span style="color: #3fc489;">(</span>not <span style="color: #6fb3c0;">(</span>atom myelt<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span>
            <span style="color: #3fc489;">(</span>setf vars <span style="color: #6fb3c0;">(</span>union <span style="color: #c0b24f;">(</span>find-variables-in-statement myelt<span style="color: #c0b24f;">)</span> vars<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    vars<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">find-constants-in-statement</span> <span style="color: #ffaacf;">(</span>statement<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"find all constants in a statement, constants are non-variable literals, basically words that arent predicates (symbol at the beginning of a list) or variables (symbol starting with '?')"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #80aadf;">(</span>atom statement<span style="color: #80aadf;">)</span>
      <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #e47980;">(</span>variable? statement<span style="color: #e47980;">)</span>
          nil
          <span style="color: #e47980;">(</span>list statement<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
      <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #e47980;">(</span><span style="color: #d0b0ff;">(</span>constants<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
        <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for myelt in <span style="color: #d0b0ff;">(</span>cdr statement<span style="color: #d0b0ff;">)</span> do
          <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #3fc489;">(</span>compound? myelt<span style="color: #3fc489;">)</span>
              <span style="color: #3fc489;">(</span>setf constants <span style="color: #6fb3c0;">(</span>union <span style="color: #c0b24f;">(</span>find-constants-in-statement <span style="color: #f3a0a0;">(</span>cdr myelt<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span> constants<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span>
              <span style="color: #3fc489;">(</span>setf constants <span style="color: #6fb3c0;">(</span>union <span style="color: #c0b24f;">(</span>find-constants-in-statement myelt<span style="color: #c0b24f;">)</span> constants<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
        constants<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">find-constants-in-knowledge-base</span> <span style="color: #ffaacf;">(</span>knowledge-base<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"find all constants in a knowledge base"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>constants<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for statement in knowledge-base do
      <span style="color: #e47980;">(</span>setf constants <span style="color: #d0b0ff;">(</span>union <span style="color: #3fc489;">(</span>find-constants-in-statement statement<span style="color: #3fc489;">)</span> constants<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    constants<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">standardize-variables</span> <span style="color: #ffaacf;">(</span>formula<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"replace variables with new unseen unique variable names, implementation is inefficient but it'll do for now</span>
<span style="color: #caa89f; font-style: italic;">example usage:</span>
<span style="color: #caa89f; font-style: italic;">CL-USER&gt; (setf a '(hi ?there (whats up) up ?there ?what))</span>
<span style="color: #caa89f; font-style: italic;">CL-USER&gt; (standardize-variables a)</span>
<span style="color: #caa89f; font-style: italic;">(HI #:?479 (WHATS UP) UP #:?479 #:?481)</span>
<span style="color: #caa89f; font-style: italic;">CL-USER&gt; (standardize-variables '(implies (and (king ?x) (greedy ?x)) (evil ?x)))</span>
<span style="color: #caa89f; font-style: italic;">(IMPLIES (AND (KING #:?495) (GREEDY #:?495)) (EVIL #:?495))</span>
<span style="color: #caa89f; font-style: italic;">"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>vars <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #3fc489;">(</span>compound? formula<span style="color: #3fc489;">)</span>
                  <span style="color: #3fc489;">(</span>find-variables-in-statement formula<span style="color: #3fc489;">)</span>
                  nil<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">nil if the formula is just a constant</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for var in vars do
      <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">generate a new variable (symbol) that starts with '?' to replace each variable</span>
      <span style="color: #e47980;">(</span>setf formula <span style="color: #d0b0ff;">(</span>subst <span style="color: #3fc489;">(</span>gensym <span style="color: #f3a0a0;">"?"</span><span style="color: #3fc489;">)</span> var formula<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    formula<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">all-substitutions</span> <span style="color: #ffaacf;">(</span>variables constants<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"generate all possible substitutions, a substitution is a list of cons's"</span>
  <span style="color: #ffaacf;">(</span>list* nil <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">nil is a possible substitution too</span>
         <span style="color: #80aadf;">(</span>concatenate*
          <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #d0b0ff;">(</span><span style="color: #3fc489;">(</span>variable-combinations <span style="color: #6fb3c0;">(</span>combinations-upto-length variables<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
            <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for variable-combination in variable-combinations
                  collect <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #6fb3c0;">(</span><span style="color: #c0b24f;">(</span>constant-variations <span style="color: #f3a0a0;">(</span>variations-with-repetition constants <span style="color: #deb07a;">(</span>length variable-combination<span style="color: #deb07a;">)</span><span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                            <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for constant-variation in constant-variations
                                  collect <span style="color: #c0b24f;">(</span>pairlis variable-combination constant-variation<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">apply-substitution</span> <span style="color: #ffaacf;">(</span>sub formula<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"given the substitution `</span><span style="color: #80aadf; font-style: italic;">sub</span><span style="color: #caa89f; font-style: italic;">', which is a list of conses (basically an alist), apply it to a given formula"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for entry in sub do
    <span style="color: #80aadf;">(</span>setf formula <span style="color: #e47980;">(</span>subst <span style="color: #d0b0ff;">(</span>cdr entry<span style="color: #d0b0ff;">)</span> <span style="color: #d0b0ff;">(</span>car entry<span style="color: #d0b0ff;">)</span> formula<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span>
  formula<span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">implication?</span> <span style="color: #ffaacf;">(</span>formula<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"check whether a logic formula is an implication formula of the form 'something =&gt; something' or in lisp (implies something something)"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">when</span> <span style="color: #80aadf;">(</span>compound? formula<span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span>eq <span style="color: #e47980;">(</span>first formula<span style="color: #e47980;">)</span> 'implies<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">parse-implication</span> <span style="color: #ffaacf;">(</span>formula<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"given an implication formula `</span><span style="color: #80aadf; font-style: italic;">formula</span><span style="color: #caa89f; font-style: italic;">', return both the implying expression and the implied expression (precedent and consequent)"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #80aadf;">(</span>implication? formula<span style="color: #80aadf;">)</span>
      <span style="color: #80aadf;">(</span>values <span style="color: #e47980;">(</span>second formula<span style="color: #e47980;">)</span> <span style="color: #e47980;">(</span>third formula<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
      <span style="color: #80aadf;">(</span>values nil formula<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">conjunction?</span> <span style="color: #ffaacf;">(</span>formula<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"check if a formula is a conjunction of predicates"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">when</span> <span style="color: #80aadf;">(</span>compound? formula<span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span>eq <span style="color: #e47980;">(</span>first formula<span style="color: #e47980;">)</span> 'and<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">forward-chaining</span> <span style="color: #ffaacf;">(</span>knowledge-base query <span style="color: #a9c99f;">&amp;optional</span> <span style="color: #80aadf;">(</span>add-query-to-kb t<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"apply the forward chaining algorithm to the knowledge base `</span><span style="color: #80aadf; font-style: italic;">knowledge-base</span><span style="color: #caa89f; font-style: italic;">' and the query `</span><span style="color: #80aadf; font-style: italic;">query</span><span style="color: #caa89f; font-style: italic;">', tries to infer the query from the knowledge base, returns `</span><span style="color: #80aadf; font-style: italic;">nil</span><span style="color: #caa89f; font-style: italic;">' if it fails, if `</span><span style="color: #80aadf; font-style: italic;">add-query-to-kb</span><span style="color: #caa89f; font-style: italic;">' is `</span><span style="color: #80aadf; font-style: italic;">t</span><span style="color: #caa89f; font-style: italic;">', `</span><span style="color: #80aadf; font-style: italic;">query</span><span style="color: #caa89f; font-style: italic;">' gets added to the knowledge base (along with the other conclusions)"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>inference-alist-list<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">list of association lists that holds the antecedents of the inferences, each association list corresponds to a chaining step</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> do
      <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #d0b0ff;">(</span><span style="color: #3fc489;">(</span>new<span style="color: #3fc489;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">list to hold newly inferred sentences on each iteration</span>
            <span style="color: #3fc489;">(</span>inference-alist<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
        <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for formula in knowledge-base do
          <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">when</span> <span style="color: #6fb3c0;">(</span>implication? formula<span style="color: #6fb3c0;">)</span>
            <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">in an implication 'a-&gt;b', 'a' is the antecedent and 'b' is the consequent</span>
            <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">multiple-value-bind</span> <span style="color: #c0b24f;">(</span>antecedent consequent<span style="color: #c0b24f;">)</span>
                <span style="color: #c0b24f;">(</span>parse-implication formula<span style="color: #c0b24f;">)</span>
              <span style="color: #c0b24f;">(</span><span style="color: #deb07a; font-weight: bold;">let*</span> <span style="color: #f3a0a0;">(</span><span style="color: #deb07a;">(</span>standardized-antecedent <span style="color: #ffaacf;">(</span>standardize-variables antecedent<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">change variable names in formula to avoid unification problems, see [[id:40d1a33f-7e80-4b94-bc0c-c778beefca01::note:note1]]</span>
                     <span style="color: #deb07a;">(</span>vars <span style="color: #ffaacf;">(</span>append <span style="color: #80aadf;">(</span>find-variables-in-statement formula<span style="color: #80aadf;">)</span>
                                   <span style="color: #80aadf;">(</span>find-variables-in-statement standardized-antecedent<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span><span style="color: #f3a0a0;">)</span>
                <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">generate possible values for the substitution, see [[id:bd481a5c-e869-440e-be1d-33e0838620f9::note:theta_domain]]</span>
                <span style="color: #f3a0a0;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for sub in <span style="color: #deb07a;">(</span>all-substitutions vars <span style="color: #ffaacf;">(</span>find-constants-in-knowledge-base knowledge-base<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span> do
                  <span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for some-premises in <span style="color: #ffaacf;">(</span>variations-upto-length
                                              <span style="color: #80aadf;">(</span>remove-if #'implication?
                                                         knowledge-base<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span>
                        do <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">when</span> <span style="color: #80aadf;">(</span>or <span style="color: #e47980;">(</span>equal <span style="color: #d0b0ff;">(</span>apply-substitution sub antecedent<span style="color: #d0b0ff;">)</span>
                                            <span style="color: #d0b0ff;">(</span>apply-substitution sub <span style="color: #3fc489;">(</span>list* 'and some-premises<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">construct the AND (conjunction) predicate</span>
                                     <span style="color: #e47980;">(</span>equal <span style="color: #d0b0ff;">(</span>apply-substitution sub <span style="color: #3fc489;">(</span>list antecedent<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
                                            <span style="color: #d0b0ff;">(</span>apply-substitution sub some-premises<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
                             <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #e47980;">(</span><span style="color: #d0b0ff;">(</span>actual-consequent <span style="color: #3fc489;">(</span>apply-substitution sub consequent<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">non-standardized (original variables names) consequent</span>
                                   <span style="color: #d0b0ff;">(</span>unifies nil<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
                               <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">check if it unifies with another formula something in `</span><span style="color: #80aadf; font-style: italic;">new</span><span style="color: #a0a0cf; font-style: italic;">'</span>
                               <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for other-formula in new do
                                 <span style="color: #d0b0ff;">(</span>setf unifies <span style="color: #3fc489;">(</span>or unifies
                                                   <span style="color: #6fb3c0;">(</span>unify-success? <span style="color: #c0b24f;">(</span>unify actual-consequent other-formula<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
                               <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">check if it unifies with another formula something in `</span><span style="color: #80aadf; font-style: italic;">knowledge-base</span><span style="color: #a0a0cf; font-style: italic;">'</span>
                               <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for other-formula-again in knowledge-base do
                                 <span style="color: #d0b0ff;">(</span>setf unifies <span style="color: #3fc489;">(</span>or unifies
                                                   <span style="color: #6fb3c0;">(</span>unify-success? <span style="color: #c0b24f;">(</span>unify actual-consequent other-formula-again<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
                               <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">when</span> <span style="color: #d0b0ff;">(</span>not unifies<span style="color: #d0b0ff;">)</span>
                                 <span style="color: #d0b0ff;">(</span>setf new <span style="color: #3fc489;">(</span>append new <span style="color: #6fb3c0;">(</span>list actual-consequent<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
                                 <span style="color: #d0b0ff;">(</span>setf inference-alist
                                       <span style="color: #3fc489;">(</span>append inference-alist
                                               <span style="color: #6fb3c0;">(</span>list <span style="color: #c0b24f;">(</span>cons actual-consequent
                                                           <span style="color: #f3a0a0;">(</span>apply-substitution sub antecedent<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
                                 <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #3fc489;">(</span><span style="color: #6fb3c0;">(</span>unify-out <span style="color: #c0b24f;">(</span>unify actual-consequent query<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span>
                                   <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">when</span> <span style="color: #6fb3c0;">(</span>unify-success? unify-out<span style="color: #6fb3c0;">)</span>
                                     <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">when</span> add-query-to-kb
                                       <span style="color: #c0b24f;">(</span>nconc knowledge-base new<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">final addition to knowledge base before returning</span>
                                     <span style="color: #6fb3c0;">(</span>setf inference-alist-list <span style="color: #c0b24f;">(</span>append inference-alist-list <span style="color: #f3a0a0;">(</span>list inference-alist<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                                     <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">return-from</span> forward-chaining
                                       <span style="color: #c0b24f;">(</span>values unify-out
                                               inference-alist-list<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span><span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
        <span style="color: #d0b0ff;">(</span>setf inference-alist-list <span style="color: #3fc489;">(</span>append inference-alist-list <span style="color: #6fb3c0;">(</span>list inference-alist<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
        <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> new
            <span style="color: #3fc489;">(</span>nconc knowledge-base new<span style="color: #3fc489;">)</span>
            <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">return-from</span> forward-chaining <span style="color: #6fb3c0;">(</span>values nil inference-alist-list<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<p>
example usage:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">forward-chaining-test-1</span> <span style="color: #ffaacf;">()</span>
  <span style="color: #ffaacf;">(</span>setf *forward-chaining-test-1-kb*
        '<span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>implies <span style="color: #d0b0ff;">(</span>and <span style="color: #3fc489;">(</span>american ?x<span style="color: #3fc489;">)</span> <span style="color: #3fc489;">(</span>weapon ?y<span style="color: #3fc489;">)</span> <span style="color: #3fc489;">(</span>sells ?x ?y ?z<span style="color: #3fc489;">)</span> <span style="color: #3fc489;">(</span>hostile ?z<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span> <span style="color: #d0b0ff;">(</span>criminal ?x<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>implies <span style="color: #d0b0ff;">(</span>and <span style="color: #3fc489;">(</span>missile ?x<span style="color: #3fc489;">)</span> <span style="color: #3fc489;">(</span>owns nono ?x<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span> <span style="color: #d0b0ff;">(</span>sells west ?x nono<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>implies <span style="color: #d0b0ff;">(</span>missile ?x<span style="color: #d0b0ff;">)</span> <span style="color: #d0b0ff;">(</span>weapon ?x<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>implies <span style="color: #d0b0ff;">(</span>enemy ?x america<span style="color: #d0b0ff;">)</span> <span style="color: #d0b0ff;">(</span>hostile ?x<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>owns nono m1<span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>missile m1<span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>american west<span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>enemy nono america<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>kb2 <span style="color: #d0b0ff;">(</span>copy-tree *forward-chaining-test-1-kb*<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">multiple-value-bind</span> <span style="color: #e47980;">(</span>substitution inference-alist-list<span style="color: #e47980;">)</span>
        <span style="color: #e47980;">(</span>forward-chaining kb2 '<span style="color: #d0b0ff;">(</span>criminal west<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
      <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">not a good idea to use setf but should be fine for debugging</span>
      <span style="color: #e47980;">(</span>setf *forward-chaining-test-1-inference-alist-list* inference-alist-list<span style="color: #e47980;">)</span>
      <span style="color: #e47980;">(</span>setf *forward-chaining-test-1-kb-result* kb2<span style="color: #e47980;">)</span>
      kb2<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<p>
some functions (that do their best) to "unpack" a knowledge base by unpacking conjunctions and implications into multiple smaller statements that are easier to deal with (there isnt much we can do when the precedent of an implication is a <a href="/logical_connective.html">logical connective</a>)
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">unpack-implication</span> <span style="color: #ffaacf;">(</span>implication<span style="color: #ffaacf;">)</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">multiple-value-bind</span> <span style="color: #80aadf;">(</span>antecedent consequent<span style="color: #80aadf;">)</span>
      <span style="color: #80aadf;">(</span>parse-implication implication<span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #e47980;">(</span>conjunction? consequent<span style="color: #e47980;">)</span>
        <span style="color: #e47980;">(</span>mapcar <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">lambda</span> <span style="color: #3fc489;">(</span>consequent-predicate<span style="color: #3fc489;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">one predicate from the conjunction in the consequent</span>
                  <span style="color: #3fc489;">(</span>list 'implies antecedent consequent-predicate<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
                <span style="color: #d0b0ff;">(</span>unpack-conjunction consequent<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
        <span style="color: #e47980;">(</span>list implication<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">unpack-conjunction</span> <span style="color: #ffaacf;">(</span>conjunction<span style="color: #ffaacf;">)</span>
  <span style="color: #ffaacf;">(</span>cdr conjunction<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">unpack-formula</span> <span style="color: #ffaacf;">(</span>formula<span style="color: #ffaacf;">)</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #80aadf;">(</span>implication? formula<span style="color: #80aadf;">)</span>
      <span style="color: #80aadf;">(</span>unpack-implication formula<span style="color: #80aadf;">)</span>
      <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #e47980;">(</span>conjunction? formula<span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>unpack-conjunction formula<span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>list formula<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">unpack-knowledge-base</span> <span style="color: #ffaacf;">(</span>kb<span style="color: #ffaacf;">)</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>new-kb<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for formula in kb do
      <span style="color: #e47980;">(</span>setf new-kb <span style="color: #d0b0ff;">(</span>append new-kb <span style="color: #3fc489;">(</span>unpack-formula formula<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    new-kb<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<p>
a function to generate a graph from a knowledge base, see <a href="/working_with_graphs_in_common_lisp.html">common lisp graphs</a>:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">generate-graph-from-knowledge-base</span> <span style="color: #ffaacf;">(</span>kb<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"generate and-or graph (not really, cant tell OR from AND) for a knowledge base"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>g <span style="color: #d0b0ff;">(</span>make-graph<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for statement in <span style="color: #e47980;">(</span>unpack-knowledge-base kb<span style="color: #e47980;">)</span> do
      <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #d0b0ff;">(</span>implication? statement<span style="color: #d0b0ff;">)</span>
          <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">multiple-value-bind</span> <span style="color: #3fc489;">(</span>antecedent consequent<span style="color: #3fc489;">)</span> <span style="color: #3fc489;">(</span>parse-implication statement<span style="color: #3fc489;">)</span>
            <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #6fb3c0;">(</span>conjunction? antecedent<span style="color: #6fb3c0;">)</span>
                <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for predicate in <span style="color: #c0b24f;">(</span>cdr antecedent<span style="color: #c0b24f;">)</span> do
                  <span style="color: #c0b24f;">(</span>graph-add-edge g predicate consequent<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                <span style="color: #6fb3c0;">(</span>graph-add-edge g antecedent consequent<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
          <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #3fc489;">(</span>conjunction? statement<span style="color: #3fc489;">)</span>
              <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for predicate in <span style="color: #6fb3c0;">(</span>cdr statement<span style="color: #6fb3c0;">)</span> do
                <span style="color: #6fb3c0;">(</span>graph-add-vertex g predicate<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span>
              <span style="color: #3fc489;">(</span>graph-add-vertex g statement<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    g<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<p>
example usage:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">forward-chaining-test-2</span> <span style="color: #ffaacf;">()</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>kb <span style="color: #d0b0ff;">(</span>copy-tree '<span style="color: #3fc489;">(</span><span style="color: #6fb3c0;">(</span>implies <span style="color: #c0b24f;">(</span>and <span style="color: #f3a0a0;">(</span>american ?x<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>weapon ?y<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>sells ?x ?y ?z<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>hostile ?z<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>criminal ?x<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                         <span style="color: #6fb3c0;">(</span>implies <span style="color: #c0b24f;">(</span>and <span style="color: #f3a0a0;">(</span>missile ?x<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>owns nono ?x<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>sells west ?x nono<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                         <span style="color: #6fb3c0;">(</span>implies <span style="color: #c0b24f;">(</span>missile ?x<span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>weapon ?x<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                         <span style="color: #6fb3c0;">(</span>implies <span style="color: #c0b24f;">(</span>enemy ?x america<span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>hostile ?x<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                         <span style="color: #6fb3c0;">(</span>owns nono m1<span style="color: #6fb3c0;">)</span>
                         <span style="color: #6fb3c0;">(</span>missile m1<span style="color: #6fb3c0;">)</span>
                         <span style="color: #6fb3c0;">(</span>american west<span style="color: #6fb3c0;">)</span>
                         <span style="color: #6fb3c0;">(</span>enemy nono america<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #e47980;">(</span><span style="color: #d0b0ff;">(</span>g <span style="color: #3fc489;">(</span>generate-graph-from-knowledge-base kb<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
          <span style="color: #d0b0ff;">(</span>vertex-idx 0<span style="color: #d0b0ff;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">to number vertices (gotta do it for proper drawing of the graph), each vertex gets a unique number</span>
          <span style="color: #d0b0ff;">(</span>vertex-indicies-cache nil<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">cache vertex indicies</span>
      <span style="color: #e47980;">(</span>graph-generate-tikz
       g
       <span style="color: #e3b0c0; font-weight: bold;">:format-function</span> <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">lambda</span> <span style="color: #3fc489;">(</span>vertex<span style="color: #3fc489;">)</span>
                          <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #6fb3c0;">(</span><span style="color: #c0b24f;">(</span>vertex-entry
                                  <span style="color: #f3a0a0;">(</span>assoc
                                   vertex
                                   vertex-indicies-cache
                                   <span style="color: #e3b0c0; font-weight: bold;">:test</span> #'equal<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                                   <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">:test (lambda (predicate1 predicate2)</span>
                                   <span style="color: #a0a0cf; font-style: italic;">;;         </span><span style="color: #a0a0cf; font-style: italic;">(unify-success? (unify predicate1 predicate2))))))</span>
                            <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> vertex-entry
                                <span style="color: #c0b24f;">(</span>format nil <span style="color: #f3a0a0;">"v~A/{~A}"</span> <span style="color: #f3a0a0;">(</span>cdr vertex-entry<span style="color: #f3a0a0;">)</span> vertex<span style="color: #c0b24f;">)</span>
                                <span style="color: #c0b24f;">(</span><span style="color: #deb07a; font-weight: bold;">progn</span>
                                  <span style="color: #f3a0a0;">(</span>incf vertex-idx<span style="color: #f3a0a0;">)</span>
                                  <span style="color: #f3a0a0;">(</span>setf vertex-indicies-cache <span style="color: #deb07a;">(</span>acons vertex vertex-idx vertex-indicies-cache<span style="color: #deb07a;">)</span><span style="color: #f3a0a0;">)</span>
                                  <span style="color: #f3a0a0;">(</span>format nil <span style="color: #f3a0a0;">"v~A/{~A}"</span> vertex-idx vertex<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>
       <span style="color: #e3b0c0; font-weight: bold;">:tikz-params</span> <span style="color: #f3a0a0;">"layered layout, grow=up, edges={-{Stealth[]}}, edges=rounded corners"</span>
       <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">:node-distance 50</span>
       <span style="color: #e3b0c0; font-weight: bold;">:directed</span> t<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span>forward-chaining-test-2<span style="color: #deb07a;">)</span>
</pre>
</div>


<p>

</p>


<div class="equation-container">
<span class="equation">
<?xml version='1.0' encoding='UTF-8'?>

<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='3.31969 -41.629975 1173.011253 38.30948' style="max-height: 4.5200em; vertical-align: -0.0492em; display: inline-block" class="org-latex org-latex-inline">
<defs>
<path id='g3-27' d='m7.143213 0v-.308842h-.179328c-.597758 0-.737235-.069738-.846824-.398506l-2.15193-6.22665c-.049813-.129514-.069738-.199253-.229141-.199253s-.18929 .059776-.239103 .199253l-2.062267 5.957659c-.179328 .508095-.577833 .657534-1.115816 .667497v.308842l1.016189-.029888l1.145704 .029888v-.308842c-.498132 0-.747198-.249066-.747198-.508095c0-.029888 .009963-.129514 .019925-.14944l.458281-1.305106h2.460772l.52802 1.524284c.009963 .039851 .029888 .099626 .029888 .139477c0 .298879-.557908 .298879-.826899 .298879v.308842c.358655-.029888 1.05604-.029888 1.43462-.029888l1.305106 .029888zm-2.580324-2.580324h-2.241594l1.115816-3.237858l1.125778 3.237858z'/>
<path id='g3-42' d='m6.625156-2.321295c0-.099626 0-.169365-.129514-.169365c-.109589 0-.109589 .059776-.119552 .159402c-.079701 1.424658-1.145704 2.241594-2.231631 2.241594c-.607721 0-2.560399-.33873-2.560399-3.307597c0-2.978829 1.942715-3.317559 2.550436-3.317559c1.085928 0 1.972603 .9066 2.171856 2.361146c.019925 .139477 .019925 .169365 .159402 .169365c.159402 0 .159402-.029888 .159402-.239103v-2.361146c0-.169365 0-.239103-.109589-.239103c-.039851 0-.079701 0-.159402 .119552l-.498132 .737235c-.368618-.358655-.876712-.856787-1.833126-.856787c-1.863014 0-3.466999 1.58406-3.466999 3.616438c0 2.062267 1.613948 3.626401 3.466999 3.626401c1.62391 0 2.600249-1.384807 2.600249-2.540473z'/>
<path id='g3-49' d='m6.495641-2.570361h-.249066c-.249066 1.534247-.478207 2.261519-2.191781 2.261519h-1.325031c-.468244 0-.488169-.069738-.488169-.398506v-2.660025h.896638c.966376 0 1.075965 .318804 1.075965 1.165629h.249066v-2.6401h-.249066c0 .856787-.109589 1.165629-1.075965 1.165629h-.896638v-2.391034c0-.328767 .019925-.398506 .488169-.398506h1.285181c1.524284 0 1.793275 .547945 1.952677 1.932752h.249066l-.278954-2.241594h-5.608966v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.220423c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842h5.748443l.418431-2.570361z'/>
<path id='g3-62' d='m7.13325 0v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-5.250311c0-.358655 .019925-.468244 .787049-.468244h.239103v-.308842c-.348692 .029888-1.085928 .029888-1.464508 .029888s-1.125778 0-1.474471-.029888v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v2.331258h-2.978829v-2.331258c0-.358655 .019925-.468244 .787049-.468244h.239103v-.308842c-.348692 .029888-1.085928 .029888-1.464508 .029888s-1.125778 0-1.474471-.029888v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.250311c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.348692-.029888 1.085928-.029888 1.464508-.029888s1.125778 0 1.474471 .029888v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-2.610212h2.978829v2.610212c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.348692-.029888 1.085928-.029888 1.464508-.029888s1.125778 0 1.474471 .029888z'/>
<path id='g3-65' d='m3.317559 0v-.308842h-.259029c-.787049 0-.816936-.109589-.816936-.468244v-5.250311c0-.358655 .029888-.468244 .816936-.468244h.259029v-.308842c-.348692 .029888-1.135741 .029888-1.514321 .029888c-.388543 0-1.175592 0-1.524284-.029888v.308842h.259029c.787049 0 .816936 .109589 .816936 .468244v5.250311c0 .358655-.029888 .468244-.816936 .468244h-.259029v.308842c.348692-.029888 1.135741-.029888 1.514321-.029888c.388543 0 1.175592 0 1.524284 .029888z'/>
<path id='g3-71' d='m5.798257-2.570361h-.249066c-.109589 1.016189-.249066 2.261519-2.002491 2.261519h-.816936c-.468244 0-.488169-.069738-.488169-.398506v-5.310087c0-.33873 0-.478207 .946451-.478207h.328767v-.308842c-.358655 .029888-1.265255 .029888-1.673724 .029888c-.388543 0-1.165629 0-1.514321-.029888v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.250311c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842h5.190535l.278954-2.570361z'/>
<path id='g3-74' d='m8.757161 0v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-5.250311c0-.358655 .019925-.468244 .787049-.468244h.239103v-.308842h-1.683686c-.259029 0-.259029 .009963-.328767 .18929l-2.181818 5.608966l-2.161893-5.579078c-.089664-.219178-.119552-.219178-.348692-.219178h-1.683686v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v4.98132c0 .268991 0 .737235-1.026152 .737235v.308842l1.165629-.029888l1.165629 .029888v-.308842c-1.026152 0-1.026152-.468244-1.026152-.737235v-5.369863h.009963l2.400996 6.196762c.049813 .129514 .099626 .219178 .199253 .219178c.109589 0 .139477-.079701 .179328-.18929l2.450809-6.306351h.009963v5.718555c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.368618-.029888 1.046077-.029888 1.43462-.029888s1.05604 0 1.424658 .029888z'/>
<path id='g3-76' d='m7.13325-6.495641v-.308842l-1.165629 .029888l-1.165629-.029888v.308842c1.026152 0 1.026152 .468244 1.026152 .737235v4.254047l-3.516812-5.17061c-.089664-.119552-.099626-.129514-.288917-.129514h-1.693649v.308842h.288917c.14944 0 .348692 .009963 .498132 .019925c.229141 .029888 .239103 .039851 .239103 .229141v5.200498c0 .268991 0 .737235-1.026152 .737235v.308842l1.165629-.029888l1.165629 .029888v-.308842c-1.026152 0-1.026152-.468244-1.026152-.737235v-5.180573c.049813 .049813 .059776 .059776 .099626 .119552l4.064757 5.977584c.089664 .119552 .099626 .129514 .169365 .129514c.139477 0 .139477-.069738 .139477-.259029v-5.499377c0-.268991 0-.737235 1.026152-.737235z'/>
<path id='g3-80' d='m7.183064-3.377335c0-2.032379-1.504359-3.646326-3.317559-3.646326c-1.783313 0-3.307597 1.594022-3.307597 3.646326c0 2.042341 1.534247 3.596513 3.307597 3.596513c1.8132 0 3.317559-1.58406 3.317559-3.596513zm-1.026152-.139477c0 2.6401-1.364882 3.476961-2.281445 3.476961c-.956413 0-2.291407-.876712-2.291407-3.476961c0-2.580324 1.454545-3.257783 2.281445-3.257783c.86675 0 2.291407 .707347 2.291407 3.257783z'/>
<path id='g3-82' d='m4.174346 0v-.308842h-.318804c-.896638 0-.926526-.109589-.926526-.478207v-5.589041c0-.239103 0-.259029-.229141-.259029c-.617684 .637609-1.494396 .637609-1.8132 .637609v.308842c.199253 0 .787049 0 1.305106-.259029v5.160648c0 .358655-.029888 .478207-.926526 .478207h-.318804v.308842c.348692-.029888 1.215442-.029888 1.613948-.029888s1.265255 0 1.613948 .029888z'/>
<path id='g3-83' d='m6.216687-4.951432c0-.976339-.986301-1.853051-2.351183-1.853051h-3.516812v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.250311c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.348692-.029888 1.085928-.029888 1.464508-.029888s1.125778 0 1.474471 .029888v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-2.371108h1.683686c1.195517 0 2.271482-.806974 2.271482-1.803238zm-1.026152 0c0 .468244 0 1.544209-1.58406 1.544209h-1.374844v-2.689913c0-.328767 .019925-.398506 .488169-.398506h.886675c1.58406 0 1.58406 1.05604 1.58406 1.544209z'/>
<path id='g3-85' d='m3.297634 2.391034c0-.029888 0-.049813-.169365-.219178c-1.24533-1.255293-1.564134-3.138232-1.564134-4.662516c0-1.733499 .37858-3.466999 1.603985-4.712329c.129514-.119552 .129514-.139477 .129514-.169365c0-.069738-.039851-.099626-.099626-.099626c-.099626 0-.996264 .67746-1.58406 1.942715c-.508095 1.09589-.627646 2.201743-.627646 3.038605c0 .777086 .109589 1.982565 .657534 3.108344c.597758 1.225405 1.454545 1.872976 1.554172 1.872976c.059776 0 .099626-.029888 .099626-.099626z'/>
<path id='g3-86' d='m2.879203-2.49066c0-.777086-.109589-1.982565-.657534-3.108344c-.597758-1.225405-1.454545-1.872976-1.554172-1.872976c-.059776 0-.099626 .039851-.099626 .099626c0 .029888 0 .049813 .18929 .229141c.976339 .986301 1.544209 2.570361 1.544209 4.652553c0 1.703611-.368618 3.457036-1.603985 4.712329c-.129514 .119552-.129514 .139477-.129514 .169365c0 .059776 .039851 .099626 .099626 .099626c.099626 0 .996264-.67746 1.58406-1.942715c.508095-1.09589 .627646-2.201743 .627646-3.038605z'/>
<path id='g3-92' d='m4.134496-5.678705c0-.577833-.398506-1.344956-1.882939-1.344956c-1.075965 0-1.693649 .67746-1.693649 1.325031c0 .33873 .229141 .478207 .458281 .478207c.278954 0 .458281-.199253 .458281-.458281c0-.448319-.418431-.448319-.557908-.448319c.308842-.52802 .886675-.67746 1.305106-.67746c1.085928 0 1.085928 .67746 1.085928 1.066002c0 .587796-.159402 .767123-.33873 .946451c-.657534 .71731-.876712 1.633873-.876712 2.241594v.448319c0 .179328 0 .239103 .119552 .239103c.129514 0 .129514-.089664 .129514-.268991v-.348692c0-1.255293 .966376-1.96264 1.315068-2.221669c.268991-.199253 .478207-.557908 .478207-.976339zm-1.39477 5.150685c0-.288917-.239103-.52802-.52802-.52802s-.52802 .239103-.52802 .52802s.239103 .52802 .52802 .52802s.52802-.239103 .52802-.52802z'/>
<path id='g3-95' d='m7.292653-.876712c0-.059776 0-.169365-.129514-.169365c-.109589 0-.109589 .089664-.119552 .159402c-.059776 .707347-.408468 .886675-.657534 .886675c-.488169 0-.56787-.508095-.707347-1.43462l-.129514-.797011c-.179328-.637609-.667497-.966376-1.215442-1.155666c.966376-.239103 1.743462-.846824 1.743462-1.62391c0-.956413-1.135741-1.793275-2.600249-1.793275h-3.128269v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.250311c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.358655-.029888 1.066002-.029888 1.454545-.029888s1.09589 0 1.454545 .029888v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-2.520548h1.145704c.159402 0 .577833 0 .926526 .33873c.37858 .358655 .37858 .667497 .37858 1.334994c0 .647572 0 1.046077 .408468 1.424658c.408468 .358655 .956413 .418431 1.255293 .418431c.777086 0 .946451-.816936 .946451-1.09589zm-2.241594-4.134496c0 .687422-.239103 1.494396-1.713574 1.494396h-1.105853v-2.580324c0-.229141 0-.348692 .219178-.37858c.099626-.019925 .388543-.019925 .587796-.019925c.896638 0 2.012453 .039851 2.012453 1.484433z'/>
<path id='g3-97' d='m4.971357-1.853051c0-.996264-.657534-1.8132-1.494396-2.012453l-1.275218-.308842c-.617684-.14944-1.006227-.687422-1.006227-1.265255c0-.697385 .537983-1.305106 1.315068-1.305106c1.663761 0 1.882939 1.633873 1.942715 2.082192c.009963 .059776 .009963 .119552 .119552 .119552c.129514 0 .129514-.049813 .129514-.239103v-2.002491c0-.169365 0-.239103-.109589-.239103c-.069738 0-.079701 .009963-.14944 .129514l-.348692 .56787c-.298879-.288917-.707347-.697385-1.594022-.697385c-1.105853 0-1.942715 .876712-1.942715 1.932752c0 .826899 .52802 1.554172 1.305106 1.823163c.109589 .039851 .617684 .159402 1.315068 .328767c.268991 .069738 .56787 .139477 .846824 .508095c.209215 .259029 .308842 .587796 .308842 .916563c0 .707347-.498132 1.424658-1.334994 1.424658c-.288917 0-1.046077-.049813-1.574097-.537983c-.577833-.537983-.607721-1.175592-.617684-1.534247c-.009963-.099626-.089664-.099626-.119552-.099626c-.129514 0-.129514 .069738-.129514 .249066v1.992528c0 .169365 0 .239103 .109589 .239103c.069738 0 .079701-.019925 .14944-.129514c0 0 .029888-.039851 .358655-.56787c.308842 .33873 .946451 .697385 1.833126 .697385c1.165629 0 1.96264-.976339 1.96264-2.072229z'/>
<path id='g3-104' d='m6.824408-4.503113l-.18929-2.241594h-6.087173l-.18929 2.241594h.249066c.139477-1.603985 .288917-1.932752 1.793275-1.932752c.179328 0 .438356 0 .537983 .019925c.209215 .039851 .209215 .14944 .209215 .37858v5.250311c0 .33873 0 .478207-1.046077 .478207h-.398506v.308842c.408468-.029888 1.424658-.029888 1.882939-.029888s1.484433 0 1.892902 .029888v-.308842h-.398506c-1.046077 0-1.046077-.139477-1.046077-.478207v-5.250311c0-.199253 0-.33873 .179328-.37858c.109589-.019925 .37858-.019925 .56787-.019925c1.504359 0 1.653798 .328767 1.793275 1.932752h.249066z'/>
<path id='g3-113' d='m10.052304-6.495641v-.308842c-.298879 .019925-.607721 .029888-.9066 .029888l-1.185554-.029888v.308842c.667497 .009963 .86675 .33873 .86675 .52802c0 .059776-.029888 .139477-.049813 .199253l-1.494396 4.60274l-1.594022-4.881694c-.009963-.039851-.029888-.099626-.029888-.14944c0-.298879 .577833-.298879 .836862-.298879v-.308842c-.358655 .029888-1.036115 .029888-1.414695 .029888l-1.215442-.029888v.308842c.56787 0 .777086 0 .896638 .358655l.219178 .697385l-1.384807 4.273973l-1.603985-4.901619c-.009963-.029888-.019925-.099626-.019925-.129514c0-.298879 .577833-.298879 .836862-.298879v-.308842c-.358655 .029888-1.036115 .029888-1.414695 .029888l-1.215442-.029888v.308842c.747198 0 .787049 .049813 .9066 .418431l1.992528 6.107098c.029888 .089664 .059776 .18929 .18929 .18929c.139477 0 .159402-.069738 .199253-.199253l1.643836-5.061021l1.653798 5.070984c.029888 .089664 .059776 .18929 .18929 .18929c.139477 0 .159402-.069738 .199253-.199253l1.902864-5.84807c.179328-.56787 .607721-.667497 .996264-.667497z'/>
<path id='g3-115' d='m7.232877 0v-.308842h-.18929c-.518057 0-.727273-.049813-.936488-.358655l-2.102117-3.178082l1.364882-2.002491c.219178-.318804 .557908-.637609 1.444583-.647572v-.308842l-1.105853 .029888c-.398506 0-.876712 0-1.275218-.029888v.308842c.398506 .009963 .617684 .229141 .617684 .458281c0 .099626-.019925 .119552-.089664 .229141l-1.135741 1.683686l-1.285181-1.92279c-.019925-.029888-.069738-.109589-.069738-.14944c0-.119552 .219178-.288917 .647572-.298879v-.308842c-.348692 .029888-1.075965 .029888-1.454545 .029888l-1.295143-.029888v.308842h.18929c.547945 0 .737235 .069738 .926526 .348692l1.833126 2.769614l-1.633873 2.410959c-.139477 .199253-.438356 .657534-1.444583 .657534v.308842l1.105853-.029888c.368618 0 .916563 0 1.275218 .029888v-.308842c-.458281-.009963-.627646-.278954-.627646-.458281c0-.089664 .029888-.129514 .099626-.239103l1.414695-2.092154l1.574097 2.381071c.019925 .039851 .049813 .079701 .049813 .109589c0 .119552-.219178 .288917-.647572 .298879v.308842c.348692-.029888 1.075965-.029888 1.454545-.029888l1.295143 .029888z'/>
<path id='g3-117' d='m7.352428-6.495641v-.308842c-.308842 .019925-.707347 .029888-.976339 .029888l-1.145704-.029888v.308842c.408468 0 .56787 .18929 .56787 .388543c0 .109589-.059776 .239103-.099626 .298879l-1.643836 2.669988l-1.803238-2.938979c-.069738-.099626-.069738-.119552-.069738-.169365c0-.209215 .249066-.249066 .697385-.249066v-.308842c-.358655 .029888-1.085928 .029888-1.474471 .029888l-1.295143-.029888v.308842h.179328c.67746 0 .757161 .109589 .916563 .368618l2.092154 3.407223v1.942715c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.358655-.029888 1.066002-.029888 1.454545-.029888s1.09589 0 1.454545 .029888v-.308842h-.229141c-.767123 0-.797011-.099626-.797011-.488169v-1.92279l1.92279-3.128269c.368618-.607721 .956413-.647572 1.275218-.647572z'/>
<path id='g3-119' d='m5.579078-2.660025h-.249066c-.079701 1.384807-.268991 2.321295-2.11208 2.321295h-1.633873l3.865504-6.117061c.069738-.109589 .069738-.119552 .069738-.18929c0-.159402-.059776-.159402-.259029-.159402h-4.463263l-.109589 2.241594h.249066c.069738-1.125778 .368618-1.932752 2.002491-1.932752h1.564134l-3.875467 6.127024c-.069738 .109589-.069738 .119552-.069738 .199253c0 .169365 .049813 .169365 .259029 .169365h4.592777l.169365-2.660025z'/>
</defs>
<g id='page4'>
<path d='m531.887-16.80469v-8.27736' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m531.886596-27.5781l-1.343746 3.570317l1.343746-1.175777l1.347654 1.175777z'/>
<path d='m531.886596-27.5781l-1.343746 3.570317l1.343746-1.175777l1.347654 1.175777z' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m772.637-16.80469l2.886-8.44536' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m776.332362-27.609372l-2.429698 2.94139l1.652326-.675784l.894536 1.546884z'/>
<path d='m776.332362-27.609372l-2.429698 2.94139l1.652326-.675784l.894536 1.546884z' stroke='currentColor' fill='none' stroke-width='.398492' stroke-miterlimit='10'/>
<path d='m670.672-16.80469v-8.27736' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m670.671404-27.5781l-1.347654 3.570317l1.347654-1.175777l1.343746 1.175777z'/>
<path d='m670.671404-27.5781l-1.347654 3.570317l1.347654-1.175777l1.343746 1.175777z' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m740.023-16.80469l-36.699-10.49996' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m700.925507-27.992225l3.062503 2.277342l-.757794-1.617202l1.496108-.968737z'/>
<path d='m700.925507-27.992225l3.062503 2.277342l-.757794-1.617202l1.496108-.968737z' stroke='currentColor' fill='none' stroke-width='.398493' stroke-miterlimit='10'/>
<path d='m1106.394-16.09766l-53.757-11.41409' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m1050.197187-28.031234l3.214869 2.058595l-.871045-1.558588l1.429732-1.074211z'/>
<path d='m1050.197187-28.031234l3.214869 2.058595l-.871045-1.558588l1.429732-1.074211z' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m1041.145-16.80469l-15.442-9.71096' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m1023.592614-27.843711l2.304661 3.039027l-.277319-1.765609l1.710941-.511726z'/>
<path d='m1023.592614-27.843711l2.304661 3.039027l-.277319-1.765609l1.710941-.511726z' stroke='currentColor' fill='none' stroke-width='.398486' stroke-miterlimit='10'/>
<path d='m978.047-16.80469l15.441-9.71096' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m995.597603-27.843671l-3.738282 .761686l1.71094 .511732l-.277318 1.765604z'/>
<path d='m995.597603-27.843671l-3.738282 .761686l1.71094 .511732l-.277318 1.765604z' stroke='currentColor' fill='none' stroke-width='.398486' stroke-miterlimit='10'/>
<path d='m916.156-16.80469l50.414-10.70706' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m969.011896-28.031275l-3.769488-.574233l1.425739 1.074234l-.867174 1.558589z'/>
<path d='m969.011896-28.031275l-3.769488-.574233l1.425739 1.074234l-.867174 1.558589z' stroke='currentColor' fill='none' stroke-width='.398492' stroke-miterlimit='10'/>
<g fill='currentColor'>
<g transform='translate(-65.73433 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-49'/>
<use x='79.714045' y='-8.301845' xlink:href='#g3-76'/>
<use x='87.186025' y='-8.301845' xlink:href='#g3-49'/>
<use x='93.970583' y='-8.301845' xlink:href='#g3-74'/>
<use x='103.106324' y='-8.301845' xlink:href='#g3-117'/>
<use x='113.895865' y='-8.301845' xlink:href='#g3-76'/>
<use x='121.367845' y='-8.301845' xlink:href='#g3-80'/>
<use x='129.118779' y='-8.301845' xlink:href='#g3-76'/>
<use x='136.59076' y='-8.301845' xlink:href='#g3-80'/>
<use x='147.659254' y='-8.301845' xlink:href='#g3-27'/>
<use x='155.131235' y='-8.301845' xlink:href='#g3-74'/>
<use x='164.266976' y='-8.301845' xlink:href='#g3-49'/>
<use x='171.051533' y='-8.301845' xlink:href='#g3-95'/>
<use x='178.384037' y='-8.301845' xlink:href='#g3-65'/>
<use x='181.98055' y='-8.301845' xlink:href='#g3-42'/>
<use x='189.173576' y='-8.301845' xlink:href='#g3-27'/>
<use x='196.645556' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(87.718 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-27'/>
<use x='80.401468' y='-8.301845' xlink:href='#g3-74'/>
<use x='89.537208' y='-8.301845' xlink:href='#g3-49'/>
<use x='96.321766' y='-8.301845' xlink:href='#g3-95'/>
<use x='103.65427' y='-8.301845' xlink:href='#g3-65'/>
<use x='107.250783' y='-8.301845' xlink:href='#g3-42'/>
<use x='114.443809' y='-8.301845' xlink:href='#g3-27'/>
<use x='121.915789' y='-8.301845' xlink:href='#g3-76'/>
<use x='132.70533' y='-8.301845' xlink:href='#g3-113'/>
<use x='142.946924' y='-8.301845' xlink:href='#g3-49'/>
<use x='149.731482' y='-8.301845' xlink:href='#g3-97'/>
<use x='155.27071' y='-8.301845' xlink:href='#g3-104'/>
<use x='162.463736' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(206.988 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-74'/>
<use x='82.065228' y='-8.301845' xlink:href='#g3-65'/>
<use x='85.661741' y='-8.301845' xlink:href='#g3-97'/>
<use x='91.200969' y='-8.301845' xlink:href='#g3-97'/>
<use x='96.740197' y='-8.301845' xlink:href='#g3-65'/>
<use x='100.33671' y='-8.301845' xlink:href='#g3-71'/>
<use x='106.56336' y='-8.301845' xlink:href='#g3-49'/>
<use x='116.665479' y='-8.301845' xlink:href='#g3-74'/>
<use x='125.80122' y='-8.301845' xlink:href='#g3-82'/>
<use x='130.78254' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(294.577 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-80'/>
<use x='80.401469' y='-8.301845' xlink:href='#g3-113'/>
<use x='90.643063' y='-8.301845' xlink:href='#g3-76'/>
<use x='98.115043' y='-8.301845' xlink:href='#g3-97'/>
<use x='106.971832' y='-8.301845' xlink:href='#g3-76'/>
<use x='114.443812' y='-8.301845' xlink:href='#g3-80'/>
<use x='122.194746' y='-8.301845' xlink:href='#g3-76'/>
<use x='129.666726' y='-8.301845' xlink:href='#g3-80'/>
<use x='140.735221' y='-8.301845' xlink:href='#g3-74'/>
<use x='149.870962' y='-8.301845' xlink:href='#g3-82'/>
<use x='154.852282' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(406.236 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-49'/>
<use x='79.714045' y='-8.301845' xlink:href='#g3-76'/>
<use x='87.186025' y='-8.301845' xlink:href='#g3-49'/>
<use x='93.970583' y='-8.301845' xlink:href='#g3-74'/>
<use x='103.106324' y='-8.301845' xlink:href='#g3-117'/>
<use x='113.895865' y='-8.301845' xlink:href='#g3-92'/>
<use x='118.598231' y='-8.301845' xlink:href='#g3-115'/>
<use x='129.387773' y='-8.301845' xlink:href='#g3-27'/>
<use x='136.859753' y='-8.301845' xlink:href='#g3-74'/>
<use x='145.995494' y='-8.301845' xlink:href='#g3-49'/>
<use x='152.780051' y='-8.301845' xlink:href='#g3-95'/>
<use x='160.112555' y='-8.301845' xlink:href='#g3-65'/>
<use x='163.709068' y='-8.301845' xlink:href='#g3-42'/>
<use x='170.902094' y='-8.301845' xlink:href='#g3-27'/>
<use x='178.374074' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(428.931 -25.85615)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-62'/>
<use x='80.401468' y='-8.301845' xlink:href='#g3-80'/>
<use x='88.152402' y='-8.301845' xlink:href='#g3-97'/>
<use x='93.691629' y='-8.301845' xlink:href='#g3-104'/>
<use x='100.884656' y='-8.301845' xlink:href='#g3-65'/>
<use x='104.481169' y='-8.301845' xlink:href='#g3-71'/>
<use x='110.707819' y='-8.301845' xlink:href='#g3-49'/>
<use x='120.809938' y='-8.301845' xlink:href='#g3-92'/>
<use x='125.512304' y='-8.301845' xlink:href='#g3-115'/>
<use x='132.984284' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(668.846 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-74'/>
<use x='82.065228' y='-8.301845' xlink:href='#g3-65'/>
<use x='85.661741' y='-8.301845' xlink:href='#g3-97'/>
<use x='91.200969' y='-8.301845' xlink:href='#g3-97'/>
<use x='96.740197' y='-8.301845' xlink:href='#g3-65'/>
<use x='100.33671' y='-8.301845' xlink:href='#g3-71'/>
<use x='106.56336' y='-8.301845' xlink:href='#g3-49'/>
<use x='116.665479' y='-8.301845' xlink:href='#g3-92'/>
<use x='121.367845' y='-8.301845' xlink:href='#g3-115'/>
<use x='128.839826' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(675.491 -25.85615)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-113'/>
<use x='83.171081' y='-8.301845' xlink:href='#g3-49'/>
<use x='89.955639' y='-8.301845' xlink:href='#g3-27'/>
<use x='97.427619' y='-8.301845' xlink:href='#g3-83'/>
<use x='104.212177' y='-8.301845' xlink:href='#g3-80'/>
<use x='111.963111' y='-8.301845' xlink:href='#g3-76'/>
<use x='122.752652' y='-8.301845' xlink:href='#g3-92'/>
<use x='127.455019' y='-8.301845' xlink:href='#g3-115'/>
<use x='134.926999' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(557.75 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-80'/>
<use x='80.401469' y='-8.301845' xlink:href='#g3-113'/>
<use x='90.643063' y='-8.301845' xlink:href='#g3-76'/>
<use x='98.115043' y='-8.301845' xlink:href='#g3-97'/>
<use x='106.971832' y='-8.301845' xlink:href='#g3-76'/>
<use x='114.443812' y='-8.301845' xlink:href='#g3-80'/>
<use x='122.194746' y='-8.301845' xlink:href='#g3-76'/>
<use x='129.666726' y='-8.301845' xlink:href='#g3-80'/>
<use x='140.735221' y='-8.301845' xlink:href='#g3-92'/>
<use x='145.437587' y='-8.301845' xlink:href='#g3-115'/>
<use x='152.909567' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(541.416 -25.85615)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-97'/>
<use x='78.468715' y='-8.301845' xlink:href='#g3-49'/>
<use x='85.253273' y='-8.301845' xlink:href='#g3-71'/>
<use x='91.479923' y='-8.301845' xlink:href='#g3-71'/>
<use x='97.706573' y='-8.301845' xlink:href='#g3-97'/>
<use x='106.563362' y='-8.301845' xlink:href='#g3-113'/>
<use x='116.804956' y='-8.301845' xlink:href='#g3-49'/>
<use x='123.589514' y='-8.301845' xlink:href='#g3-97'/>
<use x='129.128742' y='-8.301845' xlink:href='#g3-104'/>
<use x='139.639329' y='-8.301845' xlink:href='#g3-92'/>
<use x='144.341695' y='-8.301845' xlink:href='#g3-115'/>
<use x='155.131236' y='-8.301845' xlink:href='#g3-76'/>
<use x='162.603216' y='-8.301845' xlink:href='#g3-80'/>
<use x='170.35415' y='-8.301845' xlink:href='#g3-76'/>
<use x='177.826131' y='-8.301845' xlink:href='#g3-80'/>
<use x='185.577065' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(1040.856 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-62'/>
<use x='80.401468' y='-8.301845' xlink:href='#g3-80'/>
<use x='88.152402' y='-8.301845' xlink:href='#g3-97'/>
<use x='93.691629' y='-8.301845' xlink:href='#g3-104'/>
<use x='100.884656' y='-8.301845' xlink:href='#g3-65'/>
<use x='104.481169' y='-8.301845' xlink:href='#g3-71'/>
<use x='110.707819' y='-8.301845' xlink:href='#g3-49'/>
<use x='120.809938' y='-8.301845' xlink:href='#g3-92'/>
<use x='125.512304' y='-8.301845' xlink:href='#g3-119'/>
<use x='131.599477' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(902.906 -25.85615)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-42'/>
<use x='80.122514' y='-8.301845' xlink:href='#g3-95'/>
<use x='87.455017' y='-8.301845' xlink:href='#g3-65'/>
<use x='91.05153' y='-8.301845' xlink:href='#g3-74'/>
<use x='100.187271' y='-8.301845' xlink:href='#g3-65'/>
<use x='103.783784' y='-8.301845' xlink:href='#g3-76'/>
<use x='111.255764' y='-8.301845' xlink:href='#g3-27'/>
<use x='118.727744' y='-8.301845' xlink:href='#g3-71'/>
<use x='128.271955' y='-8.301845' xlink:href='#g3-92'/>
<use x='132.974321' y='-8.301845' xlink:href='#g3-115'/>
<use x='140.446301' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(944.026 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-97'/>
<use x='78.468715' y='-8.301845' xlink:href='#g3-49'/>
<use x='85.253273' y='-8.301845' xlink:href='#g3-71'/>
<use x='91.479923' y='-8.301845' xlink:href='#g3-71'/>
<use x='97.706573' y='-8.301845' xlink:href='#g3-97'/>
<use x='106.563362' y='-8.301845' xlink:href='#g3-92'/>
<use x='111.265728' y='-8.301845' xlink:href='#g3-115'/>
<use x='122.055269' y='-8.301845' xlink:href='#g3-92'/>
<use x='126.757636' y='-8.301845' xlink:href='#g3-117'/>
<use x='137.547177' y='-8.301845' xlink:href='#g3-92'/>
<use x='142.249543' y='-8.301845' xlink:href='#g3-119'/>
<use x='148.336716' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(860.601 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-113'/>
<use x='83.171081' y='-8.301845' xlink:href='#g3-49'/>
<use x='89.955639' y='-8.301845' xlink:href='#g3-27'/>
<use x='97.427619' y='-8.301845' xlink:href='#g3-83'/>
<use x='104.212177' y='-8.301845' xlink:href='#g3-80'/>
<use x='111.963111' y='-8.301845' xlink:href='#g3-76'/>
<use x='122.752652' y='-8.301845' xlink:href='#g3-92'/>
<use x='127.455019' y='-8.301845' xlink:href='#g3-117'/>
<use x='134.926999' y='-8.301845' xlink:href='#g3-86'/>
</g>
<g transform='translate(767.224 2.49069)'>
<use x='69.05402' y='-8.301845' xlink:href='#g3-85'/>
<use x='72.929487' y='-8.301845' xlink:href='#g3-27'/>
<use x='80.401468' y='-8.301845' xlink:href='#g3-74'/>
<use x='89.537208' y='-8.301845' xlink:href='#g3-49'/>
<use x='96.321766' y='-8.301845' xlink:href='#g3-95'/>
<use x='103.65427' y='-8.301845' xlink:href='#g3-65'/>
<use x='107.250783' y='-8.301845' xlink:href='#g3-42'/>
<use x='114.443809' y='-8.301845' xlink:href='#g3-27'/>
<use x='121.915789' y='-8.301845' xlink:href='#g3-76'/>
<use x='132.70533' y='-8.301845' xlink:href='#g3-92'/>
<use x='137.407696' y='-8.301845' xlink:href='#g3-115'/>
<use x='144.879676' y='-8.301845' xlink:href='#g3-86'/>
</g>
</g>
</g>
</svg>
</span>
<span class="caption"></span>
</div>

<p>
functions to generate a graph from the forward chaining process (see <a href="/working_with_graphs_in_common_lisp.html">common lisp graphs</a>):
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">forward-chaining-generate-inference-graph</span> <span style="color: #ffaacf;">(</span>inference-alist-list<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"generate and-or graph (not really, cant tell OR from AND) for a knowledge base"</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>g <span style="color: #d0b0ff;">(</span>make-graph<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for inference-alist in inference-alist-list do
      <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for entry in inference-alist do
        <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #3fc489;">(</span><span style="color: #6fb3c0;">(</span>precedent <span style="color: #c0b24f;">(</span>cdr entry<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
              <span style="color: #6fb3c0;">(</span>consequent <span style="color: #c0b24f;">(</span>car entry<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span>
          <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #6fb3c0;">(</span>conjunction? precedent<span style="color: #6fb3c0;">)</span>
              <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for predicate in <span style="color: #c0b24f;">(</span>cdr precedent<span style="color: #c0b24f;">)</span> do
                <span style="color: #c0b24f;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #f3a0a0;">(</span>conjunction? consequent<span style="color: #f3a0a0;">)</span>
                    <span style="color: #f3a0a0;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for consequent-predicate in <span style="color: #deb07a;">(</span>cdr consequent<span style="color: #deb07a;">)</span> do
                      <span style="color: #deb07a;">(</span>graph-add-edge g predicate consequent-predicate<span style="color: #deb07a;">)</span><span style="color: #f3a0a0;">)</span>
                    <span style="color: #f3a0a0;">(</span>graph-add-edge g predicate consequent<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
              <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #c0b24f;">(</span>conjunction? consequent<span style="color: #c0b24f;">)</span>
                  <span style="color: #c0b24f;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for consequent-predicate in <span style="color: #f3a0a0;">(</span>cdr consequent<span style="color: #f3a0a0;">)</span> do
                    <span style="color: #f3a0a0;">(</span>graph-add-edge g precedent consequent-predicate<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span>
                  <span style="color: #c0b24f;">(</span>graph-add-edge g precedent consequent<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    g<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">forward-chaining-generate-tikz-graph</span> <span style="color: #ffaacf;">(</span>inference-alist-list<span style="color: #ffaacf;">)</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let*</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>g <span style="color: #d0b0ff;">(</span>forward-chaining-generate-inference-graph inference-alist-list<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
         <span style="color: #e47980;">(</span>vertex-idx 0<span style="color: #e47980;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">to number vertices (gotta do it for proper drawing of the graph), each vertex gets a unique number)</span>
         <span style="color: #e47980;">(</span>vertex-indicies-cache nil<span style="color: #e47980;">)</span> <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">cache vertex indicies</span>
         <span style="color: #e47980;">(</span>vertex-format-function
           <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">lambda</span> <span style="color: #3fc489;">(</span>vertex<span style="color: #3fc489;">)</span>
             <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #6fb3c0;">(</span><span style="color: #c0b24f;">(</span>vertex-entry
                     <span style="color: #f3a0a0;">(</span>assoc
                      vertex
                      vertex-indicies-cache
                      <span style="color: #e3b0c0; font-weight: bold;">:test</span> #'equal<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
               <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> vertex-entry
                   <span style="color: #c0b24f;">(</span>format nil <span style="color: #f3a0a0;">"v~A/{~A}"</span> <span style="color: #f3a0a0;">(</span>cdr vertex-entry<span style="color: #f3a0a0;">)</span> vertex<span style="color: #c0b24f;">)</span>
                   <span style="color: #c0b24f;">(</span><span style="color: #deb07a; font-weight: bold;">progn</span>
                     <span style="color: #f3a0a0;">(</span>incf vertex-idx<span style="color: #f3a0a0;">)</span>
                     <span style="color: #f3a0a0;">(</span>setf vertex-indicies-cache <span style="color: #deb07a;">(</span>acons vertex vertex-idx vertex-indicies-cache<span style="color: #deb07a;">)</span><span style="color: #f3a0a0;">)</span>
                     <span style="color: #f3a0a0;">(</span>format nil <span style="color: #f3a0a0;">"v~A/{~A}"</span> vertex-idx vertex<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span>graph-generate-tikz
     g
     <span style="color: #e3b0c0; font-weight: bold;">:format-function</span> vertex-format-function
     <span style="color: #e3b0c0; font-weight: bold;">:tikz-params</span> <span style="color: #f3a0a0;">"layered layout, grow=up, edges={-{Stealth[]}}, edges=rounded corners, level sep=40px"</span>
     <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">incomplete attempt to make the figure look more like [[id:bd481a5c-e869-440e-be1d-33e0838620f9::fig:fig4][forward chaining]]</span>
     <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">:tikz-postamble</span>
     <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">(concatenate*</span>
     <span style="color: #a0a0cf; font-style: italic;">;;  </span><span style="color: #a0a0cf; font-style: italic;">(mapcar (lambda (inference-alist)</span>
     <span style="color: #a0a0cf; font-style: italic;">;;            </span><span style="color: #a0a0cf; font-style: italic;">(apply #'concatenate</span>
     <span style="color: #a0a0cf; font-style: italic;">;;                   </span><span style="color: #a0a0cf; font-style: italic;">(append (list 'string)</span>
     <span style="color: #a0a0cf; font-style: italic;">;;                           </span><span style="color: #a0a0cf; font-style: italic;">(list "{[same layer] ")</span>
     <span style="color: #a0a0cf; font-style: italic;">;;                           </span><span style="color: #a0a0cf; font-style: italic;">(mapcar (lambda (vertex-entry)</span>
     <span style="color: #a0a0cf; font-style: italic;">;;                                     </span><span style="color: #a0a0cf; font-style: italic;">(format nil "~A," (funcall vertex-format-function</span>
     <span style="color: #a0a0cf; font-style: italic;">;;                                                                </span><span style="color: #a0a0cf; font-style: italic;">(car vertex-entry))))</span>
     <span style="color: #a0a0cf; font-style: italic;">;;                                   </span><span style="color: #a0a0cf; font-style: italic;">inference-alist)</span>
     <span style="color: #a0a0cf; font-style: italic;">;;                           </span><span style="color: #a0a0cf; font-style: italic;">(list " };"))))</span>
     <span style="color: #a0a0cf; font-style: italic;">;;          </span><span style="color: #a0a0cf; font-style: italic;">*forward-chaining-test-1-inference-alist-list*))</span>
     <span style="color: #e3b0c0; font-weight: bold;">:directed</span> t<span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<p>
example usage:
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">forward-chaining-test-3</span> <span style="color: #ffaacf;">()</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">let</span> <span style="color: #80aadf;">(</span><span style="color: #e47980;">(</span>kb <span style="color: #d0b0ff;">(</span>copy-tree
             '<span style="color: #3fc489;">(</span><span style="color: #6fb3c0;">(</span>implies <span style="color: #c0b24f;">(</span>and <span style="color: #f3a0a0;">(</span>american ?x<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>weapon ?y<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>sells ?x ?y ?z<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>hostile ?z<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>criminal ?x<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
               <span style="color: #6fb3c0;">(</span>implies <span style="color: #c0b24f;">(</span>and <span style="color: #f3a0a0;">(</span>missile ?x<span style="color: #f3a0a0;">)</span> <span style="color: #f3a0a0;">(</span>owns nono ?x<span style="color: #f3a0a0;">)</span><span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>sells west ?x nono<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
               <span style="color: #6fb3c0;">(</span>implies <span style="color: #c0b24f;">(</span>missile ?x<span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>weapon ?x<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
               <span style="color: #6fb3c0;">(</span>implies <span style="color: #c0b24f;">(</span>enemy ?x america<span style="color: #c0b24f;">)</span> <span style="color: #c0b24f;">(</span>hostile ?x<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
               <span style="color: #6fb3c0;">(</span>owns nono m1<span style="color: #6fb3c0;">)</span>
               <span style="color: #6fb3c0;">(</span>missile m1<span style="color: #6fb3c0;">)</span>
               <span style="color: #6fb3c0;">(</span>american west<span style="color: #6fb3c0;">)</span>
               <span style="color: #6fb3c0;">(</span>enemy nono america<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span>
    <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">multiple-value-bind</span> <span style="color: #e47980;">(</span>substitution inference-alist-list<span style="color: #e47980;">)</span>
        <span style="color: #e47980;">(</span>forward-chaining kb '<span style="color: #d0b0ff;">(</span>criminal west<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span>
      <span style="color: #a0a0cf; font-style: italic;">;; </span><span style="color: #a0a0cf; font-style: italic;">not a good idea to use setf but should be fine for debugging</span>
      <span style="color: #e47980;">(</span>forward-chaining-generate-tikz-graph inference-alist-list<span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>

<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span>forward-chaining-test-3<span style="color: #deb07a;">)</span>
</pre>
</div>


<p>

</p>


<div class="equation-container">
<span class="equation">
<?xml version='1.0' encoding='UTF-8'?>

<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='3.315674 -127.286954 445.888582 123.96719' style="max-height: 12.9459em; vertical-align: -0.0492em; display: inline-block" class="org-latex org-latex-inline">
<defs>
<path id='g3-27' d='m7.143213 0v-.308842h-.179328c-.597758 0-.737235-.069738-.846824-.398506l-2.15193-6.22665c-.049813-.129514-.069738-.199253-.229141-.199253s-.18929 .059776-.239103 .199253l-2.062267 5.957659c-.179328 .508095-.577833 .657534-1.115816 .667497v.308842l1.016189-.029888l1.145704 .029888v-.308842c-.498132 0-.747198-.249066-.747198-.508095c0-.029888 .009963-.129514 .019925-.14944l.458281-1.305106h2.460772l.52802 1.524284c.009963 .039851 .029888 .099626 .029888 .139477c0 .298879-.557908 .298879-.826899 .298879v.308842c.358655-.029888 1.05604-.029888 1.43462-.029888l1.305106 .029888zm-2.580324-2.580324h-2.241594l1.115816-3.237858l1.125778 3.237858z'/>
<path id='g3-42' d='m6.625156-2.321295c0-.099626 0-.169365-.129514-.169365c-.109589 0-.109589 .059776-.119552 .159402c-.079701 1.424658-1.145704 2.241594-2.231631 2.241594c-.607721 0-2.560399-.33873-2.560399-3.307597c0-2.978829 1.942715-3.317559 2.550436-3.317559c1.085928 0 1.972603 .9066 2.171856 2.361146c.019925 .139477 .019925 .169365 .159402 .169365c.159402 0 .159402-.029888 .159402-.239103v-2.361146c0-.169365 0-.239103-.109589-.239103c-.039851 0-.079701 0-.159402 .119552l-.498132 .737235c-.368618-.358655-.876712-.856787-1.833126-.856787c-1.863014 0-3.466999 1.58406-3.466999 3.616438c0 2.062267 1.613948 3.626401 3.466999 3.626401c1.62391 0 2.600249-1.384807 2.600249-2.540473z'/>
<path id='g3-49' d='m6.495641-2.570361h-.249066c-.249066 1.534247-.478207 2.261519-2.191781 2.261519h-1.325031c-.468244 0-.488169-.069738-.488169-.398506v-2.660025h.896638c.966376 0 1.075965 .318804 1.075965 1.165629h.249066v-2.6401h-.249066c0 .856787-.109589 1.165629-1.075965 1.165629h-.896638v-2.391034c0-.328767 .019925-.398506 .488169-.398506h1.285181c1.524284 0 1.793275 .547945 1.952677 1.932752h.249066l-.278954-2.241594h-5.608966v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.220423c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842h5.748443l.418431-2.570361z'/>
<path id='g3-62' d='m7.13325 0v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-5.250311c0-.358655 .019925-.468244 .787049-.468244h.239103v-.308842c-.348692 .029888-1.085928 .029888-1.464508 .029888s-1.125778 0-1.474471-.029888v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v2.331258h-2.978829v-2.331258c0-.358655 .019925-.468244 .787049-.468244h.239103v-.308842c-.348692 .029888-1.085928 .029888-1.464508 .029888s-1.125778 0-1.474471-.029888v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.250311c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.348692-.029888 1.085928-.029888 1.464508-.029888s1.125778 0 1.474471 .029888v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-2.610212h2.978829v2.610212c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.348692-.029888 1.085928-.029888 1.464508-.029888s1.125778 0 1.474471 .029888z'/>
<path id='g3-65' d='m3.317559 0v-.308842h-.259029c-.787049 0-.816936-.109589-.816936-.468244v-5.250311c0-.358655 .029888-.468244 .816936-.468244h.259029v-.308842c-.348692 .029888-1.135741 .029888-1.514321 .029888c-.388543 0-1.175592 0-1.524284-.029888v.308842h.259029c.787049 0 .816936 .109589 .816936 .468244v5.250311c0 .358655-.029888 .468244-.816936 .468244h-.259029v.308842c.348692-.029888 1.135741-.029888 1.514321-.029888c.388543 0 1.175592 0 1.524284 .029888z'/>
<path id='g3-71' d='m5.798257-2.570361h-.249066c-.109589 1.016189-.249066 2.261519-2.002491 2.261519h-.816936c-.468244 0-.488169-.069738-.488169-.398506v-5.310087c0-.33873 0-.478207 .946451-.478207h.328767v-.308842c-.358655 .029888-1.265255 .029888-1.673724 .029888c-.388543 0-1.165629 0-1.514321-.029888v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.250311c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842h5.190535l.278954-2.570361z'/>
<path id='g3-74' d='m8.757161 0v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-5.250311c0-.358655 .019925-.468244 .787049-.468244h.239103v-.308842h-1.683686c-.259029 0-.259029 .009963-.328767 .18929l-2.181818 5.608966l-2.161893-5.579078c-.089664-.219178-.119552-.219178-.348692-.219178h-1.683686v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v4.98132c0 .268991 0 .737235-1.026152 .737235v.308842l1.165629-.029888l1.165629 .029888v-.308842c-1.026152 0-1.026152-.468244-1.026152-.737235v-5.369863h.009963l2.400996 6.196762c.049813 .129514 .099626 .219178 .199253 .219178c.109589 0 .139477-.079701 .179328-.18929l2.450809-6.306351h.009963v5.718555c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.368618-.029888 1.046077-.029888 1.43462-.029888s1.05604 0 1.424658 .029888z'/>
<path id='g3-76' d='m7.13325-6.495641v-.308842l-1.165629 .029888l-1.165629-.029888v.308842c1.026152 0 1.026152 .468244 1.026152 .737235v4.254047l-3.516812-5.17061c-.089664-.119552-.099626-.129514-.288917-.129514h-1.693649v.308842h.288917c.14944 0 .348692 .009963 .498132 .019925c.229141 .029888 .239103 .039851 .239103 .229141v5.200498c0 .268991 0 .737235-1.026152 .737235v.308842l1.165629-.029888l1.165629 .029888v-.308842c-1.026152 0-1.026152-.468244-1.026152-.737235v-5.180573c.049813 .049813 .059776 .059776 .099626 .119552l4.064757 5.977584c.089664 .119552 .099626 .129514 .169365 .129514c.139477 0 .139477-.069738 .139477-.259029v-5.499377c0-.268991 0-.737235 1.026152-.737235z'/>
<path id='g3-80' d='m7.183064-3.377335c0-2.032379-1.504359-3.646326-3.317559-3.646326c-1.783313 0-3.307597 1.594022-3.307597 3.646326c0 2.042341 1.534247 3.596513 3.307597 3.596513c1.8132 0 3.317559-1.58406 3.317559-3.596513zm-1.026152-.139477c0 2.6401-1.364882 3.476961-2.281445 3.476961c-.956413 0-2.291407-.876712-2.291407-3.476961c0-2.580324 1.454545-3.257783 2.281445-3.257783c.86675 0 2.291407 .707347 2.291407 3.257783z'/>
<path id='g3-82' d='m4.174346 0v-.308842h-.318804c-.896638 0-.926526-.109589-.926526-.478207v-5.589041c0-.239103 0-.259029-.229141-.259029c-.617684 .637609-1.494396 .637609-1.8132 .637609v.308842c.199253 0 .787049 0 1.305106-.259029v5.160648c0 .358655-.029888 .478207-.926526 .478207h-.318804v.308842c.348692-.029888 1.215442-.029888 1.613948-.029888s1.265255 0 1.613948 .029888z'/>
<path id='g3-83' d='m6.216687-4.951432c0-.976339-.986301-1.853051-2.351183-1.853051h-3.516812v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.250311c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.348692-.029888 1.085928-.029888 1.464508-.029888s1.125778 0 1.474471 .029888v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-2.371108h1.683686c1.195517 0 2.271482-.806974 2.271482-1.803238zm-1.026152 0c0 .468244 0 1.544209-1.58406 1.544209h-1.374844v-2.689913c0-.328767 .019925-.398506 .488169-.398506h.886675c1.58406 0 1.58406 1.05604 1.58406 1.544209z'/>
<path id='g3-85' d='m3.297634 2.391034c0-.029888 0-.049813-.169365-.219178c-1.24533-1.255293-1.564134-3.138232-1.564134-4.662516c0-1.733499 .37858-3.466999 1.603985-4.712329c.129514-.119552 .129514-.139477 .129514-.169365c0-.069738-.039851-.099626-.099626-.099626c-.099626 0-.996264 .67746-1.58406 1.942715c-.508095 1.09589-.627646 2.201743-.627646 3.038605c0 .777086 .109589 1.982565 .657534 3.108344c.597758 1.225405 1.454545 1.872976 1.554172 1.872976c.059776 0 .099626-.029888 .099626-.099626z'/>
<path id='g3-86' d='m2.879203-2.49066c0-.777086-.109589-1.982565-.657534-3.108344c-.597758-1.225405-1.454545-1.872976-1.554172-1.872976c-.059776 0-.099626 .039851-.099626 .099626c0 .029888 0 .049813 .18929 .229141c.976339 .986301 1.544209 2.570361 1.544209 4.652553c0 1.703611-.368618 3.457036-1.603985 4.712329c-.129514 .119552-.129514 .139477-.129514 .169365c0 .059776 .039851 .099626 .099626 .099626c.099626 0 .996264-.67746 1.58406-1.942715c.508095-1.09589 .627646-2.201743 .627646-3.038605z'/>
<path id='g3-95' d='m7.292653-.876712c0-.059776 0-.169365-.129514-.169365c-.109589 0-.109589 .089664-.119552 .159402c-.059776 .707347-.408468 .886675-.657534 .886675c-.488169 0-.56787-.508095-.707347-1.43462l-.129514-.797011c-.179328-.637609-.667497-.966376-1.215442-1.155666c.966376-.239103 1.743462-.846824 1.743462-1.62391c0-.956413-1.135741-1.793275-2.600249-1.793275h-3.128269v.308842h.239103c.767123 0 .787049 .109589 .787049 .468244v5.250311c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.358655-.029888 1.066002-.029888 1.454545-.029888s1.09589 0 1.454545 .029888v-.308842h-.239103c-.767123 0-.787049-.109589-.787049-.468244v-2.520548h1.145704c.159402 0 .577833 0 .926526 .33873c.37858 .358655 .37858 .667497 .37858 1.334994c0 .647572 0 1.046077 .408468 1.424658c.408468 .358655 .956413 .418431 1.255293 .418431c.777086 0 .946451-.816936 .946451-1.09589zm-2.241594-4.134496c0 .687422-.239103 1.494396-1.713574 1.494396h-1.105853v-2.580324c0-.229141 0-.348692 .219178-.37858c.099626-.019925 .388543-.019925 .587796-.019925c.896638 0 2.012453 .039851 2.012453 1.484433z'/>
<path id='g3-97' d='m4.971357-1.853051c0-.996264-.657534-1.8132-1.494396-2.012453l-1.275218-.308842c-.617684-.14944-1.006227-.687422-1.006227-1.265255c0-.697385 .537983-1.305106 1.315068-1.305106c1.663761 0 1.882939 1.633873 1.942715 2.082192c.009963 .059776 .009963 .119552 .119552 .119552c.129514 0 .129514-.049813 .129514-.239103v-2.002491c0-.169365 0-.239103-.109589-.239103c-.069738 0-.079701 .009963-.14944 .129514l-.348692 .56787c-.298879-.288917-.707347-.697385-1.594022-.697385c-1.105853 0-1.942715 .876712-1.942715 1.932752c0 .826899 .52802 1.554172 1.305106 1.823163c.109589 .039851 .617684 .159402 1.315068 .328767c.268991 .069738 .56787 .139477 .846824 .508095c.209215 .259029 .308842 .587796 .308842 .916563c0 .707347-.498132 1.424658-1.334994 1.424658c-.288917 0-1.046077-.049813-1.574097-.537983c-.577833-.537983-.607721-1.175592-.617684-1.534247c-.009963-.099626-.089664-.099626-.119552-.099626c-.129514 0-.129514 .069738-.129514 .249066v1.992528c0 .169365 0 .239103 .109589 .239103c.069738 0 .079701-.019925 .14944-.129514c0 0 .029888-.039851 .358655-.56787c.308842 .33873 .946451 .697385 1.833126 .697385c1.165629 0 1.96264-.976339 1.96264-2.072229z'/>
<path id='g3-104' d='m6.824408-4.503113l-.18929-2.241594h-6.087173l-.18929 2.241594h.249066c.139477-1.603985 .288917-1.932752 1.793275-1.932752c.179328 0 .438356 0 .537983 .019925c.209215 .039851 .209215 .14944 .209215 .37858v5.250311c0 .33873 0 .478207-1.046077 .478207h-.398506v.308842c.408468-.029888 1.424658-.029888 1.882939-.029888s1.484433 0 1.892902 .029888v-.308842h-.398506c-1.046077 0-1.046077-.139477-1.046077-.478207v-5.250311c0-.199253 0-.33873 .179328-.37858c.109589-.019925 .37858-.019925 .56787-.019925c1.504359 0 1.653798 .328767 1.793275 1.932752h.249066z'/>
<path id='g3-113' d='m10.052304-6.495641v-.308842c-.298879 .019925-.607721 .029888-.9066 .029888l-1.185554-.029888v.308842c.667497 .009963 .86675 .33873 .86675 .52802c0 .059776-.029888 .139477-.049813 .199253l-1.494396 4.60274l-1.594022-4.881694c-.009963-.039851-.029888-.099626-.029888-.14944c0-.298879 .577833-.298879 .836862-.298879v-.308842c-.358655 .029888-1.036115 .029888-1.414695 .029888l-1.215442-.029888v.308842c.56787 0 .777086 0 .896638 .358655l.219178 .697385l-1.384807 4.273973l-1.603985-4.901619c-.009963-.029888-.019925-.099626-.019925-.129514c0-.298879 .577833-.298879 .836862-.298879v-.308842c-.358655 .029888-1.036115 .029888-1.414695 .029888l-1.215442-.029888v.308842c.747198 0 .787049 .049813 .9066 .418431l1.992528 6.107098c.029888 .089664 .059776 .18929 .18929 .18929c.139477 0 .159402-.069738 .199253-.199253l1.643836-5.061021l1.653798 5.070984c.029888 .089664 .059776 .18929 .18929 .18929c.139477 0 .159402-.069738 .199253-.199253l1.902864-5.84807c.179328-.56787 .607721-.667497 .996264-.667497z'/>
<path id='g3-117' d='m7.352428-6.495641v-.308842c-.308842 .019925-.707347 .029888-.976339 .029888l-1.145704-.029888v.308842c.408468 0 .56787 .18929 .56787 .388543c0 .109589-.059776 .239103-.099626 .298879l-1.643836 2.669988l-1.803238-2.938979c-.069738-.099626-.069738-.119552-.069738-.169365c0-.209215 .249066-.249066 .697385-.249066v-.308842c-.358655 .029888-1.085928 .029888-1.474471 .029888l-1.295143-.029888v.308842h.179328c.67746 0 .757161 .109589 .916563 .368618l2.092154 3.407223v1.942715c0 .358655-.019925 .468244-.787049 .468244h-.239103v.308842c.358655-.029888 1.066002-.029888 1.454545-.029888s1.09589 0 1.454545 .029888v-.308842h-.229141c-.767123 0-.797011-.099626-.797011-.488169v-1.92279l1.92279-3.128269c.368618-.607721 .956413-.647572 1.275218-.647572z'/>
</defs>
<g id='page5'>
<path d='m355.5703-73.80469l-120.8753-39.05861' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m232.320408-113.629325l2.984367 2.378904l-.707021-1.644527l1.531244-.91797z'/>
<path d='m232.320408-113.629325l2.984367 2.378904l-.707021-1.644527l1.531244-.91797z' stroke='currentColor' fill='none' stroke-width='.398491' stroke-miterlimit='10'/>
<path d='m252.562-73.80469l-36.707-37.80081' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m214.117083-113.398387l1.52345 3.500009l.148444-1.781245l1.781244-.09377z'/>
<path d='m214.117083-113.398387l1.52345 3.500009l.148444-1.781245l1.781244-.09377z' stroke='currentColor' fill='none' stroke-width='.398478' stroke-miterlimit='10'/>
<path d='m158.375-73.80469l36.707-37.80081' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m196.820661-113.398343l-3.453147 1.624979l1.781268 .093771l.148438 1.781239z'/>
<path d='m196.820661-113.398343l-3.453147 1.624979l1.781268 .093771l.148438 1.781239z' stroke='currentColor' fill='none' stroke-width='.398478' stroke-miterlimit='10'/>
<path d='m74.852-73.80469l104.851-38.93361' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m182.043099-113.60517l-3.816414-.019531l1.570319 .851563l-.63282 1.671873z'/>
<path d='m182.043099-113.60517l-3.816414-.019531l1.570319 .851563l-.63282 1.671873z' stroke='currentColor' fill='none' stroke-width='.398483' stroke-miterlimit='10'/>
<path d='m383.23436-16.8008l-1.031247-36.9375' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m382.132413-56.234343l-1.24612 3.605468l1.312495-1.210942l1.378943 1.136724z'/>
<path d='m382.132413-56.234343l-1.24612 3.605468l1.312495-1.210942l1.378943 1.136724z' stroke='currentColor' fill='none' stroke-width='.398479' stroke-miterlimit='10'/>
<path d='m157.691-16.8008l-5.769-36.9726' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m151.534996-56.242234l-.777351 3.734383l1.148444-1.367193l1.511728 .953126z'/>
<path d='m151.534996-56.242234l-.777351 3.734383l1.148444-1.367193l1.511728 .953126z' stroke='currentColor' fill='none' stroke-width='.39848' stroke-miterlimit='10'/>
<path d='m259.461-16.8008l1.031-36.9375' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m260.562885-56.234352l-1.445315 3.531255l1.37891-1.13672l1.312497 1.210938z'/>
<path d='m260.562885-56.234352l-1.445315 3.531255l1.37891-1.13672l1.312497 1.210938z' stroke='currentColor' fill='none' stroke-width='.398479' stroke-miterlimit='10'/>
<path d='m174.199-16.8008l68.762-38.50389' stroke='currentColor' fill='none' stroke-width='.3985' stroke-miterlimit='10'/>
<path d='m245.136994-56.523467l-3.773443 .570312l1.683601 .597653l-.367189 1.750002z'/>
<path d='m245.136994-56.523467l-3.773443 .570312l1.683601 .597653l-.367189 1.750002z' stroke='currentColor' fill='none' stroke-width='.398478' stroke-miterlimit='10'/>
<g fill='currentColor'>
<g transform='translate(-43.039 2.4907)'>
<use x='381.881254' y='-65.303574' xlink:href='#g3-85'/>
<use x='385.756721' y='-65.303574' xlink:href='#g3-62'/>
<use x='393.228701' y='-65.303574' xlink:href='#g3-80'/>
<use x='400.979635' y='-65.303574' xlink:href='#g3-97'/>
<use x='406.518863' y='-65.303574' xlink:href='#g3-104'/>
<use x='413.711889' y='-65.303574' xlink:href='#g3-65'/>
<use x='417.308402' y='-65.303574' xlink:href='#g3-71'/>
<use x='423.535052' y='-65.303574' xlink:href='#g3-49'/>
<use x='433.637171' y='-65.303574' xlink:href='#g3-76'/>
<use x='441.109151' y='-65.303574' xlink:href='#g3-80'/>
<use x='448.860085' y='-65.303574' xlink:href='#g3-76'/>
<use x='456.332065' y='-65.303574' xlink:href='#g3-80'/>
<use x='464.082999' y='-65.303574' xlink:href='#g3-86'/>
</g>
<g transform='translate(-222.839 -54.5114)'>
<use x='381.881254' y='-65.303574' xlink:href='#g3-85'/>
<use x='385.756721' y='-65.303574' xlink:href='#g3-42'/>
<use x='392.949747' y='-65.303574' xlink:href='#g3-95'/>
<use x='400.28225' y='-65.303574' xlink:href='#g3-65'/>
<use x='403.878763' y='-65.303574' xlink:href='#g3-74'/>
<use x='413.014504' y='-65.303574' xlink:href='#g3-65'/>
<use x='416.611017' y='-65.303574' xlink:href='#g3-76'/>
<use x='424.082997' y='-65.303574' xlink:href='#g3-27'/>
<use x='431.554978' y='-65.303574' xlink:href='#g3-71'/>
<use x='441.099189' y='-65.303574' xlink:href='#g3-113'/>
<use x='451.340783' y='-65.303574' xlink:href='#g3-49'/>
<use x='458.125341' y='-65.303574' xlink:href='#g3-97'/>
<use x='463.664568' y='-65.303574' xlink:href='#g3-104'/>
<use x='470.857595' y='-65.303574' xlink:href='#g3-86'/>
</g>
<g transform='translate(-182.237 2.4907)'>
<use x='381.881254' y='-65.303574' xlink:href='#g3-85'/>
<use x='385.756721' y='-65.303574' xlink:href='#g3-97'/>
<use x='391.295949' y='-65.303574' xlink:href='#g3-49'/>
<use x='398.080507' y='-65.303574' xlink:href='#g3-71'/>
<use x='404.307157' y='-65.303574' xlink:href='#g3-71'/>
<use x='410.533807' y='-65.303574' xlink:href='#g3-97'/>
<use x='419.390596' y='-65.303574' xlink:href='#g3-113'/>
<use x='429.63219' y='-65.303574' xlink:href='#g3-49'/>
<use x='436.416748' y='-65.303574' xlink:href='#g3-97'/>
<use x='441.955976' y='-65.303574' xlink:href='#g3-104'/>
<use x='452.466563' y='-65.303574' xlink:href='#g3-74'/>
<use x='461.602304' y='-65.303574' xlink:href='#g3-82'/>
<use x='469.901185' y='-65.303574' xlink:href='#g3-76'/>
<use x='477.373165' y='-65.303574' xlink:href='#g3-80'/>
<use x='485.124099' y='-65.303574' xlink:href='#g3-76'/>
<use x='492.596079' y='-65.303574' xlink:href='#g3-80'/>
<use x='500.347013' y='-65.303574' xlink:href='#g3-86'/>
</g>
<g transform='translate(-267.604 2.4907)'>
<use x='381.881254' y='-65.303574' xlink:href='#g3-85'/>
<use x='385.756721' y='-65.303574' xlink:href='#g3-113'/>
<use x='395.998315' y='-65.303574' xlink:href='#g3-49'/>
<use x='402.782873' y='-65.303574' xlink:href='#g3-27'/>
<use x='410.254853' y='-65.303574' xlink:href='#g3-83'/>
<use x='417.039411' y='-65.303574' xlink:href='#g3-80'/>
<use x='424.790345' y='-65.303574' xlink:href='#g3-76'/>
<use x='435.579886' y='-65.303574' xlink:href='#g3-74'/>
<use x='444.715627' y='-65.303574' xlink:href='#g3-82'/>
<use x='449.696947' y='-65.303574' xlink:href='#g3-86'/>
</g>
<g transform='translate(-378.56558 2.4907)'>
<use x='381.881254' y='-65.303574' xlink:href='#g3-85'/>
<use x='385.756721' y='-65.303574' xlink:href='#g3-27'/>
<use x='393.228701' y='-65.303574' xlink:href='#g3-74'/>
<use x='402.364442' y='-65.303574' xlink:href='#g3-49'/>
<use x='409.149' y='-65.303574' xlink:href='#g3-95'/>
<use x='416.481503' y='-65.303574' xlink:href='#g3-65'/>
<use x='420.078016' y='-65.303574' xlink:href='#g3-42'/>
<use x='427.271042' y='-65.303574' xlink:href='#g3-27'/>
<use x='434.743022' y='-65.303574' xlink:href='#g3-76'/>
<use x='445.532563' y='-65.303574' xlink:href='#g3-113'/>
<use x='455.774157' y='-65.303574' xlink:href='#g3-49'/>
<use x='462.558715' y='-65.303574' xlink:href='#g3-97'/>
<use x='468.097943' y='-65.303574' xlink:href='#g3-104'/>
<use x='475.290969' y='-65.303574' xlink:href='#g3-86'/>
</g>
<g transform='translate(-64.144 59.49315)'>
<use x='381.881254' y='-65.303574' xlink:href='#g3-85'/>
<use x='385.756721' y='-65.303574' xlink:href='#g3-49'/>
<use x='392.541279' y='-65.303574' xlink:href='#g3-76'/>
<use x='400.013259' y='-65.303574' xlink:href='#g3-49'/>
<use x='406.797817' y='-65.303574' xlink:href='#g3-74'/>
<use x='415.933558' y='-65.303574' xlink:href='#g3-117'/>
<use x='426.723099' y='-65.303574' xlink:href='#g3-76'/>
<use x='434.195079' y='-65.303574' xlink:href='#g3-80'/>
<use x='441.946013' y='-65.303574' xlink:href='#g3-76'/>
<use x='449.417993' y='-65.303574' xlink:href='#g3-80'/>
<use x='460.486488' y='-65.303574' xlink:href='#g3-27'/>
<use x='467.958468' y='-65.303574' xlink:href='#g3-74'/>
<use x='477.094209' y='-65.303574' xlink:href='#g3-49'/>
<use x='483.878767' y='-65.303574' xlink:href='#g3-95'/>
<use x='491.21127' y='-65.303574' xlink:href='#g3-65'/>
<use x='494.807783' y='-65.303574' xlink:href='#g3-42'/>
<use x='502.000809' y='-65.303574' xlink:href='#g3-27'/>
<use x='509.472789' y='-65.303574' xlink:href='#g3-86'/>
</g>
<g transform='translate(-255.667 59.49315)'>
<use x='381.881254' y='-65.303574' xlink:href='#g3-85'/>
<use x='385.756721' y='-65.303574' xlink:href='#g3-74'/>
<use x='394.892462' y='-65.303574' xlink:href='#g3-65'/>
<use x='398.488975' y='-65.303574' xlink:href='#g3-97'/>
<use x='404.028203' y='-65.303574' xlink:href='#g3-97'/>
<use x='409.567431' y='-65.303574' xlink:href='#g3-65'/>
<use x='413.163944' y='-65.303574' xlink:href='#g3-71'/>
<use x='419.390594' y='-65.303574' xlink:href='#g3-49'/>
<use x='429.492713' y='-65.303574' xlink:href='#g3-74'/>
<use x='438.628454' y='-65.303574' xlink:href='#g3-82'/>
<use x='443.609774' y='-65.303574' xlink:href='#g3-86'/>
</g>
<g transform='translate(-167.494 59.49315)'>
<use x='381.881254' y='-65.303574' xlink:href='#g3-85'/>
<use x='385.756721' y='-65.303574' xlink:href='#g3-80'/>
<use x='393.228702' y='-65.303574' xlink:href='#g3-113'/>
<use x='403.470296' y='-65.303574' xlink:href='#g3-76'/>
<use x='410.942276' y='-65.303574' xlink:href='#g3-97'/>
<use x='419.799065' y='-65.303574' xlink:href='#g3-76'/>
<use x='427.271045' y='-65.303574' xlink:href='#g3-80'/>
<use x='435.021979' y='-65.303574' xlink:href='#g3-76'/>
<use x='442.493959' y='-65.303574' xlink:href='#g3-80'/>
<use x='453.562454' y='-65.303574' xlink:href='#g3-74'/>
<use x='462.698195' y='-65.303574' xlink:href='#g3-82'/>
<use x='467.679515' y='-65.303574' xlink:href='#g3-86'/>
</g>
</g>
</g>
</svg>
</span>
<span class="caption"></span>
</div>

<p>
the <a href="/backward_chaining.html">backward chaining</a> algorithm (we dont implement it as a generator here):
</p>
<div class="org-src-container" data-language="lisp">
<pre class="src src-lisp"><span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">backward-chaining</span> <span style="color: #ffaacf;">(</span>knowledge-base query<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"apply backward chaining, find all proofs for `</span><span style="color: #80aadf; font-style: italic;">query</span><span style="color: #caa89f; font-style: italic;">'"</span>
  <span style="color: #ffaacf;">(</span>backward-chaining-or knowledge-base query nil<span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">backward-chaining-or</span> <span style="color: #ffaacf;">(</span>knowledge-base goal substitution<span style="color: #ffaacf;">)</span>
  <span style="color: #caa89f; font-style: italic;">"returns substitutions that prove `</span><span style="color: #80aadf; font-style: italic;">goal</span><span style="color: #caa89f; font-style: italic;">'"</span>
  <span style="color: #ffaacf;">(</span>format t <span style="color: #f3a0a0;">"~A &lt;- "</span> goal<span style="color: #ffaacf;">)</span>
  <span style="color: #ffaacf;">(</span>concatenate*
   <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for implication-formula in knowledge-base
         collect <span style="color: #e47980;">(</span><span style="color: #deb07a; font-weight: bold;">multiple-value-bind</span> <span style="color: #d0b0ff;">(</span>precedent consequent<span style="color: #d0b0ff;">)</span>
                     <span style="color: #d0b0ff;">(</span>parse-implication <span style="color: #3fc489;">(</span>standardize-variables implication-formula<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span>

                   <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for substitution1 in <span style="color: #3fc489;">(</span>backward-chaining-and
                                               knowledge-base
                                               <span style="color: #6fb3c0;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #c0b24f;">(</span>conjunction? precedent<span style="color: #c0b24f;">)</span>
                                                   <span style="color: #c0b24f;">(</span>cdr precedent<span style="color: #c0b24f;">)</span>
                                                   precedent<span style="color: #6fb3c0;">)</span>
                                               <span style="color: #6fb3c0;">(</span>unify consequent
                                                      goal
                                                      substitution<span style="color: #6fb3c0;">)</span><span style="color: #3fc489;">)</span>
                         collect substitution1<span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>

<span style="color: #deb07a;">(</span><span style="color: #deb07a; font-weight: bold;">defun</span> <span style="color: #8fcfd0;">backward-chaining-and</span> <span style="color: #ffaacf;">(</span>knowledge-base goals substitution<span style="color: #ffaacf;">)</span>
  <span style="color: #ffaacf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #80aadf;">(</span>equal 'failure substitution<span style="color: #80aadf;">)</span>
      nil
      <span style="color: #80aadf;">(</span><span style="color: #deb07a; font-weight: bold;">if</span> <span style="color: #e47980;">(</span>equal <span style="color: #d0b0ff;">(</span>length goals<span style="color: #d0b0ff;">)</span> 0<span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>list substitution<span style="color: #e47980;">)</span>
          <span style="color: #e47980;">(</span>concatenate*
           <span style="color: #d0b0ff;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for substitution1 in <span style="color: #3fc489;">(</span>backward-chaining-or knowledge-base
                                                            <span style="color: #6fb3c0;">(</span>apply-substitution substitution
                                                                                <span style="color: #c0b24f;">(</span>first goals<span style="color: #c0b24f;">)</span><span style="color: #6fb3c0;">)</span>
                                                            substitution<span style="color: #3fc489;">)</span>
                 collect <span style="color: #3fc489;">(</span><span style="color: #deb07a; font-weight: bold;">loop</span> for substitution2 in <span style="color: #6fb3c0;">(</span>backward-chaining-and knowledge-base
                                                                           <span style="color: #c0b24f;">(</span>rest goals<span style="color: #c0b24f;">)</span>
                                                                           substitution1<span style="color: #6fb3c0;">)</span>
                               collect substitution2<span style="color: #3fc489;">)</span><span style="color: #d0b0ff;">)</span><span style="color: #e47980;">)</span><span style="color: #80aadf;">)</span><span style="color: #ffaacf;">)</span><span style="color: #deb07a;">)</span>
</pre>
</div>
</div>
</div>
</div>
</body>
</html>
